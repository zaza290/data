<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEMSU Food Ordering System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --primary-light: #6366f1;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-md: 0.75rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
        }

        #app {
            width: 100%;
            min-height: 100vh;
            background: var(--light);
            position: relative;
            overflow: hidden;
        }

        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background: var(--light);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .screen.active {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        .screen:not(.hidden) {
            opacity: 1;
            visibility: visible;
        }

        .hidden {
            display: none !important;
        }

        .welcome-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .logo i {
            font-size: 3rem;
            color: #fbbf24;
        }

        .logo h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .tagline {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 2rem;
        }

        .welcome-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem 0;
        }

        .food-icons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 2rem;
            font-size: 4rem;
            margin-bottom: 3rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .start-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
            max-width: 400px;
        }

        .btn-large {
            padding: 1.2rem 2rem;
            font-size: 1.1rem;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .btn-danger {
            background: linear-gradient(to right, var(--danger), #f87171);
            color: white;
        }

        .btn-success {
            background: linear-gradient(to right, var(--secondary), #34d399);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(to right, var(--warning), #fbbf24);
            color: white;
        }

        .welcome-footer {
            padding: 2rem;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
        }

        .features {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .features span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .minesweeper-container {
            min-height: 100vh;
            background: var(--light);
            padding: 2rem;
        }

        .minesweeper-header {
            margin-bottom: 2rem;
            text-align: center;
        }

        .minesweeper-header h2 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .game-info {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .info-box {
            background: white;
            padding: 1rem 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            text-align: center;
            min-width: 150px;
        }

        .info-box h3 {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .info-box p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .minesweeper-board {
            background: var(--gray-100);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .grid {
            display: grid;
            gap: 2px;
            background: var(--gray-300);
            padding: 2px;
            border-radius: var(--radius);
        }

        .cell {
            width: 35px;
            height: 35px;
            background: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            border-radius: var(--radius-sm);
        }

        .cell:hover {
            background: var(--gray-300);
        }

        .cell.revealed {
            background: white;
        }

        .cell.mine {
            background: var(--danger);
            color: white;
        }

        .cell.mine i {
            font-size: 0.8rem;
        }

        .cell.flagged {
            background: var(--warning);
            color: white;
        }

        .cell.flagged i {
            font-size: 0.8rem;
        }

        .cell.number-1 { color: #2563eb; }
        .cell.number-2 { color: #059669; }
        .cell.number-3 { color: #dc2626; }
        .cell.number-4 { color: #7c3aed; }
        .cell.number-5 { color: #9d174d; }
        .cell.number-6 { color: #0891b2; }
        .cell.number-7 { color: #000000; }
        .cell.number-8 { color: #525252; }

        .game-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .difficulty-selector {
            margin-bottom: 2rem;
            text-align: center;
        }

        .difficulty-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .difficulty-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .game-status {
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .game-status.win {
            color: var(--secondary);
        }

        .game-status.lose {
            color: var(--danger);
        }

        .auth-container {
            min-height: 100vh;
            padding: 2rem;
            background: var(--light);
        }

        .auth-header {
            margin-bottom: 3rem;
        }

        .auth-header h2 {
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-back {
            background: var(--gray-200);
            color: var(--gray-700);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .btn-back:hover {
            background: var(--gray-300);
        }

        .auth-options {
            display: grid;
            gap: 1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .auth-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: var(--shadow);
        }

        .auth-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .card-content {
            flex: 1;
        }

        .card-content h3 {
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }

        .card-content p {
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .form-container {
            min-height: 100vh;
            background: var(--light);
            padding: 2rem;
        }

        .form-header {
            margin-bottom: 2rem;
        }

        .form-header h2 {
            color: var(--primary);
            margin: 1rem 0 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-content {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h3 {
            color: var(--gray-800);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-text {
            display: block;
            margin-top: 0.375rem;
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        .required {
            color: var(--danger);
        }

        .role-selector {
            margin-bottom: 2rem;
        }

        .role-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .role-tab {
            flex: 1;
            padding: 1rem;
            background: var(--gray-100);
            border: 2px solid transparent;
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
        }

        .role-tab.active {
            background: white;
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        .role-tab i {
            font-size: 2rem;
        }

        .stores-container {
            min-height: 100vh;
            background: var(--light);
        }

        .stores-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-menu-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .admin-menu-btn:hover {
            background: var(--warning);
            transform: translateY(-2px);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius);
            transition: background 0.3s ease;
        }

        .user-profile:hover {
            background: var(--gray-100);
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .btn-cart {
            position: relative;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-600);
            cursor: pointer;
            padding: 0.5rem;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.75rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-logout {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--gray-600);
            cursor: pointer;
            padding: 0.5rem;
            transition: color 0.3s ease;
        }

        .btn-logout:hover {
            color: var(--danger);
        }

        .stores-content {
            padding: 2rem;
        }

        .stores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .store-card {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .store-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .store-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .store-icon {
            font-size: 2rem;
        }

        .store-info h3 {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .store-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .store-body {
            padding: 1.5rem;
        }

        .store-description {
            color: var(--gray-600);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .store-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .store-tag {
            padding: 0.25rem 0.75rem;
            background: var(--gray-100);
            border-radius: 1rem;
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .store-footer {
            padding: 1rem 1.5rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .store-status {
            font-size: 0.875rem;
            font-weight: 600;
        }

        .store-status.open {
            color: var(--secondary);
        }

        .store-status.closed {
            color: var(--danger);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .menu-container {
            min-height: 100vh;
            background: var(--light);
        }

        .menu-header {
            background: white;
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .header-content {
            flex: 1;
            min-width: 200px;
        }

        .header-content h1 {
            font-size: 1.5rem;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }

        .store-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--gray-600);
            flex-wrap: wrap;
        }

        .menu-content {
            padding: 1rem;
        }

        .store-banner {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            color: white;
        }

        .banner-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .store-icon-large {
            font-size: 3rem;
        }

        .store-info p {
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            font-size: 0.75rem;
            margin-right: 0.5rem;
        }

        .menu-items {
            display: grid;
            gap: 1rem;
        }

        .menu-item {
            background: white;
            border-radius: var(--radius);
            padding: 1rem;
            display: flex;
            gap: 1rem;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }

        .menu-item-content {
            flex: 1;
            min-width: 250px;
        }

        .menu-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .menu-item-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .menu-item-price {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.25rem;
        }

        .menu-item-description {
            color: var(--gray-600);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .menu-item-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-quantity {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid var(--gray-300);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-quantity:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .quantity-display {
            min-width: 40px;
            text-align: center;
            font-weight: 600;
        }

        .btn-add {
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-add:hover {
            background: var(--primary-dark);
        }

        .cart-container {
            min-height: 100vh;
            background: var(--light);
        }

        .cart-header {
            background: white;
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .cart-header h1 {
            flex: 1;
            font-size: 1.5rem;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-clear {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .cart-content {
            padding: 1rem;
            display: grid;
            gap: 2rem;
        }

        .cart-items {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .cart-item {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-info {
            flex: 1;
            min-width: 250px;
        }

        .cart-item-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .cart-item-title {
            font-weight: 600;
            color: var(--gray-800);
        }

        .cart-item-price {
            font-weight: 700;
            color: var(--primary);
        }

        .cart-item-store {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .cart-item-total {
            font-weight: 700;
            color: var(--gray-800);
            min-width: 80px;
            text-align: right;
        }

        .cart-summary {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }

        .summary-section {
            margin-bottom: 2rem;
        }

        .summary-section h3 {
            color: var(--gray-800);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: var(--gray-600);
        }

        .summary-row.total {
            border-top: 2px solid var(--gray-300);
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-weight: 700;
            color: var(--gray-800);
            font-size: 1.25rem;
        }

        .btn-checkout {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .checkout-container {
            min-height: 100vh;
            background: var(--light);
        }

        .checkout-header {
            background: white;
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .checkout-header h1 {
            flex: 1;
            font-size: 1.5rem;
            color: var(--gray-800);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkout-content {
            padding: 1rem;
        }

        .checkout-form {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .payment-options {
            display: grid;
            gap: 1rem;
        }

        .payment-option {
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .payment-option.active {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .option-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
        }

        .option-icon {
            width: 48px;
            height: 48px;
            background: var(--gray-100);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .option-info {
            flex: 1;
        }

        .option-title {
            font-weight: 600;
            color: var(--gray-800);
            display: block;
        }

        .option-subtitle {
            font-size: 0.875rem;
            color: var(--gray-600);
            display: block;
        }

        .option-check {
            color: var(--primary);
            font-size: 1.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .payment-option.active .option-check {
            opacity: 1;
        }

        .option-details {
            padding: 1rem;
            background: var(--gray-50);
            border-top: 1px solid var(--gray-200);
            display: none;
        }

        .payment-option.active .option-details {
            display: block;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn-next, .btn-back {
            flex: 1;
            justify-content: center;
            min-width: 120px;
        }

        .receipt-container {
            min-height: 100vh;
            background: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .receipt {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
        }

        .receipt-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .receipt-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .receipt-logo i {
            font-size: 2.5rem;
        }

        .receipt-logo h2 {
            font-size: 1.5rem;
        }

        .receipt-order-id {
            font-weight: 700;
            font-size: 1.25rem;
            margin-top: 1rem;
        }

        .receipt-body {
            padding: 2rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .info-row .label {
            color: var(--gray-600);
        }

        .receipt-items {
            margin: 2rem 0;
        }

        .receipt-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.875rem;
            flex-wrap: wrap;
        }

        .receipt-totals {
            margin-top: 1rem;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            color: var(--gray-600);
        }

        .total-row.grand-total {
            border-top: 2px solid var(--gray-300);
            margin-top: 0.5rem;
            padding-top: 1rem;
            font-weight: 700;
            color: var(--gray-800);
            font-size: 1.25rem;
        }

        .receipt-footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px dashed var(--gray-300);
        }

        .receipt-actions {
            display: flex;
            gap: 1rem;
            padding: 1rem 2rem 2rem;
            flex-wrap: wrap;
        }

        .receipt-actions button {
            flex: 1;
            justify-content: center;
            min-width: 120px;
        }

        .receipt-thanks {
            padding: 1rem 2rem 2rem;
            text-align: center;
            color: var(--gray-600);
            border-top: 1px solid var(--gray-200);
        }

        .admin-container {
            min-height: 100vh;
            background: var(--light);
        }

        .admin-header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-header h1 {
            font-size: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .admin-content {
            padding: 2rem;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-info h3 {
            font-size: 2rem;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }

        .stat-info p {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--gray-200);
            padding-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 0.75rem 1.5rem;
            background: var(--gray-100);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-600);
            transition: all 0.3s ease;
        }

        .admin-tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow);
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .data-table th {
            background: var(--gray-100);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 2px solid var(--gray-200);
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            color: var(--gray-600);
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .chart-container {
            height: 300px;
            margin: 2rem 0;
        }

        .search-bar {
            margin-bottom: 1.5rem;
        }

        .search-bar input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            font-size: 1rem;
        }

        .stack-display {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .stack-bar {
            width: 100px;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .stack-fill {
            height: 100%;
            background: var(--secondary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .stack-fill.low {
            background: var(--warning);
        }

        .stack-fill.critical {
            background: var(--danger);
        }

        .order-history {
            background: var(--gray-50);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .order-history-item {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-history-item:last-child {
            border-bottom: none;
        }

        .order-history-date {
            font-size: 0.875rem;
            color: var(--gray-500);
        }

        .order-history-status {
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }

        .db-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 600;
        }

        .db-status.connected {
            background: #d1fae5;
            color: #065f46;
        }

        .db-status.disconnected {
            background: #fee2e2;
            color: #991b1b;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .alert-icon {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        #alert-title {
            color: var(--gray-800);
            margin-bottom: 0.5rem;
        }

        #alert-message {
            color: var(--gray-600);
            margin-bottom: 1.5rem;
        }

        .guest-restriction-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }

        .guest-restriction-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .guest-icon {
            font-size: 3rem;
            color: var(--warning);
            margin-bottom: 1rem;
        }

        .guest-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .guest-buttons button {
            flex: 1;
            min-width: 120px;
        }

        .registration-success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(4px);
        }

        .registration-success-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .registration-icon {
            font-size: 3rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        .registration-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .registration-buttons button {
            width: 100%;
            padding: 0.75rem;
        }

        .edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            backdrop-filter: blur(4px);
        }

        .edit-modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-lg);
            max-height: 80vh;
            overflow-y: auto;
        }

        .edit-modal h3 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .btn-edit {
            background: var(--warning);
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
        }

        .btn-activate {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
        }

        .btn-deactivate {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .filter-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-controls select {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
        }

        .admin-welcome-msg {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .logo h1 {
                font-size: 2rem;
            }
            
            .food-icons {
                font-size: 3rem;
                gap: 1rem;
            }
            
            .auth-options {
                grid-template-columns: 1fr;
            }
            
            .form-content {
                padding: 1rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stores-grid {
                grid-template-columns: 1fr;
            }
            
            .stores-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
            }
            
            .role-tabs {
                flex-direction: column;
            }
            
            .menu-header {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
            
            .banner-content {
                flex-direction: column;
                text-align: center;
            }
            
            .receipt-actions {
                flex-direction: column;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
            }

            .cell {
                width: 30px;
                height: 30px;
                font-size: 0.9rem;
            }

            .game-info {
                gap: 1rem;
            }

            .info-box {
                min-width: 120px;
                padding: 0.75rem 1rem;
            }

            .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons {
                flex-direction: column;
            }

            .stack-bar {
                width: 80px;
            }
        }

        @media (max-width: 480px) {
            .logo {
                flex-direction: column;
                text-align: center;
            }
            
            .logo h1 {
                font-size: 1.75rem;
            }
            
            .btn-large {
                padding: 1rem;
                font-size: 1rem;
            }
            
            .auth-card {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
            }
            
            .card-icon {
                width: 48px;
                height: 48px;
                font-size: 1.25rem;
            }
            
            .form-header h2 {
                font-size: 1.5rem;
            }
            
            .cart-item {
                flex-direction: column;
            }
            
            .cart-item-actions {
                justify-content: space-between;
            }
            
            .admin-tabs {
                flex-direction: column;
            }

            .cell {
                width: 25px;
                height: 25px;
                font-size: 0.8rem;
            }

            .minesweeper-board {
                padding: 1rem;
            }

            .game-controls {
                flex-direction: column;
            }

            .difficulty-buttons {
                flex-direction: column;
            }

            .edit-modal-content {
                padding: 1rem;
            }

            .stack-bar {
                width: 60px;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .screen:not(.hidden) {
            animation: fadeIn 0.5s ease-out;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            
            .receipt,
            .receipt * {
                visibility: visible;
            }
            
            .receipt {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
            }
            
            .receipt-actions,
            .receipt-thanks {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div id="welcome-screen" class="screen">
            <div class="welcome-container">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <h1>NEMSU CHOW ZONE</h1>
                </div>
                <p class="subtitle">Food Ordering System</p>
                <p class="tagline">Order your favorite campus food with just a few clicks!</p>
                
                <div class="welcome-content">
                    <div class="food-icons">
                        <i class="fas fa-hamburger"></i>
                        <i class="fas fa-pizza-slice"></i>
                        <i class="fas fa-ice-cream"></i>
                        <i class="fas fa-coffee"></i>
                        <i class="fas fa-bread-slice"></i>
                    </div>
                    
                    <div class="start-options">
                        <button onclick="showAuthOptions()" class="btn-primary btn-large">
                            <i class="fas fa-play-circle"></i> START ORDERING
                        </button>
                        <button onclick="showMinesweeper()" class="btn-success btn-large">
                            <i class="fas fa-bomb"></i> PLAY MINESWEEPER
                        </button>
                        <button onclick="exitApp()" class="btn-danger btn-large">
                            <i class="fas fa-sign-out-alt"></i> EXIT SYSTEM
                        </button>
                    </div>
                </div>
                
                <div class="welcome-footer">
                    <p>For NEMSU Students & Instructors</p>
                    <div class="features">
                        <span><i class="fas fa-check-circle"></i> Easy Registration</span>
                        <span><i class="fas fa-check-circle"></i> Multiple Stores</span>
                        <span><i class="fas fa-check-circle"></i> Secure Payment</span>
                        <span><i class="fas fa-check-circle"></i> Admin Dashboard</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="minesweeper-screen" class="screen hidden">
            <div class="minesweeper-container">
                <div class="minesweeper-header">
                    <button onclick="backToWelcome()" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h2><i class="fas fa-bomb"></i> Minesweeper Game</h2>
                    <p>Clear the board without hitting any mines!</p>
                </div>

                <div class="difficulty-selector">
                    <h3>Select Difficulty:</h3>
                    <div class="difficulty-buttons">
                        <button onclick="setDifficulty('beginner')" class="difficulty-btn btn-primary" id="beginner-btn">
                            Beginner (1010, 10 mines)
                        </button>
                        <button onclick="setDifficulty('intermediate')" class="difficulty-btn btn-warning" id="intermediate-btn">
                            Intermediate (1212, 20 mines)
                        </button>
                        <button onclick="setDifficulty('expert')" class="difficulty-btn btn-danger" id="expert-btn">
                            Expert (1515, 40 mines)
                        </button>
                    </div>
                </div>

                <div class="game-status" id="game-status">Ready to play!</div>

                <div class="game-info">
                    <div class="info-box">
                        <h3>Mines Left</h3>
                        <p id="mines-left">10</p>
                    </div>
                    <div class="info-box">
                        <h3>Time</h3>
                        <p id="game-time">0s</p>
                    </div>
                    <div class="info-box">
                        <h3>Flags</h3>
                        <p id="flags-used">0</p>
                    </div>
                </div>

                <div class="minesweeper-board">
                    <div class="grid" id="minesweeper-grid">
                    </div>
                </div>

                <div class="game-controls">
                    <button onclick="resetMinesweeperGame()" class="btn-primary">
                        <i class="fas fa-redo"></i> New Game
                    </button>
                    <button onclick="showHint()" class="btn-warning" id="hint-btn">
                        <i class="fas fa-lightbulb"></i> Hint (3 left)
                    </button>
                    <button onclick="toggleFlagMode()" class="btn-success" id="flag-mode-btn">
                        <i class="fas fa-flag"></i> Flag Mode: OFF
                    </button>
                    <button onclick="cheatMode()" class="btn-danger" id="cheat-btn">
                        <i class="fas fa-eye"></i> Cheat (Peek)
                    </button>
                </div>

                <div style="margin-top: 2rem; text-align: center;">
                    <h3>How to Play:</h3>
                    <p> Left click to reveal a cell</p>
                    <p> Right click or use Flag Mode to place/remove flags</p>
                    <p> Numbers show how many mines are adjacent</p>
                    <p> Clear all non-mine cells to win!</p>
                </div>
            </div>
        </div>

        <div id="auth-screen" class="screen hidden">
            <div class="auth-container">
                <div class="auth-header">
                    <button onclick="backToWelcome()" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h2><i class="fas fa-user-circle"></i> Welcome to NEMSU Chow Zone</h2>
                    <p>Please choose an option to continue</p>
                </div>
                
                <div class="auth-options">
                    <div class="auth-card" onclick="showRegister()">
                        <div class="card-icon">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div class="card-content">
                            <h3>Register Account</h3>
                            <p>Create a new student or instructor account</p>
                        </div>
                    </div>
                    
                    <div class="auth-card" onclick="showLogin()">
                        <div class="card-icon">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <div class="card-content">
                            <h3>Login to Account</h3>
                            <p>Access your existing account (Students, Instructors, Admins)</p>
                        </div>
                    </div>
                    
                    <div class="auth-card" onclick="continueAsGuest()">
                        <div class="card-icon">
                            <i class="fas fa-user-clock"></i>
                        </div>
                        <div class="card-content">
                            <h3>Continue as Guest</h3>
                            <p>Browse stores and menu items only</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="register-screen" class="screen hidden">
            <div class="form-container">
                <div class="form-header">
                    <button onclick="backToAuth()" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h2><i class="fas fa-user-plus"></i> Create Account</h2>
                    <p>Join NEMSU Chow Zone community</p>
                </div>

                <div class="form-content">
                    <div class="role-selector">
                        <div class="role-tabs">
                            <button id="student-tab" class="role-tab active" onclick="selectRole('student')">
                                <i class="fas fa-graduation-cap"></i>
                                <span>Student</span>
                            </button>
                            <button id="instructor-tab" class="role-tab" onclick="selectRole('instructor')">
                                <i class="fas fa-chalkboard-teacher"></i>
                                <span>Instructor</span>
                            </button>
                        </div>
                    </div>

                    <form id="register-form" onsubmit="registerUser(event)">
                        <div class="form-section">
                            <h3><i class="fas fa-user"></i> Personal Information</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>First Name <span class="required">*</span></label>
                                    <input type="text" id="first-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Last Name <span class="required">*</span></label>
                                    <input type="text" id="last-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Middle Name <span class="required">*</span></label>
                                    <input type="text" id="middle-name" required>
                                </div>
                                <div class="form-group">
                                    <label>Age <span class="required">*</span></label>
                                    <input type="number" id="age" min="15" max="80" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-graduation-cap"></i> Academic Information</h3>
                            <div id="academic-fields">
                                <div class="form-group">
                                    <label>Course <span class="required">*</span></label>
                                    <select id="course" required>
                                        <option value="">Select Course</option>
                                        <option value="BSIT">BS Information Technology</option>
                                        <option value="BSCS">BS Computer Science</option>
                                        <option value="BSIS">BS Information Systems</option>
                                        <option value="BSEd">BS Education</option>
                                        <option value="BSBA">BS Business Administration</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-address-book"></i> Contact Information</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Phone Number <span class="required">*</span></label>
                                    <input type="tel" id="phone" pattern="09[0-9]{9}" placeholder="09123456789" required>
                                    <small class="form-text">Format: 09XXXXXXXXX (11 digits)</small>
                                </div>
                                <div class="form-group">
                                    <label>Email Address <span class="required">*</span></label>
                                    <input type="email" id="email" placeholder="example@gmail.com" required>
                                    <small class="form-text">Must be a Gmail address</small>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3><i class="fas fa-lock"></i> Security</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Password <span class="required">*</span></label>
                                    <input type="password" id="password" minlength="4" maxlength="21" required>
                                    <small class="form-text">4-21 characters</small>
                                </div>
                                <div class="form-group">
                                    <label>Confirm Password <span class="required">*</span></label>
                                    <input type="password" id="confirm-password" required>
                                </div>
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-user-check"></i> Create Account
                            </button>
                            <button type="button" onclick="backToAuth()" class="btn-secondary">
                                Cancel
                            </button>
                        </div>
                        
                        <p style="margin-top: 1rem; text-align: center;">
                            Already have an account? <a href="#" onclick="showLogin()" style="color: var(--primary);">Login here</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <div id="login-screen" class="screen hidden">
            <div class="form-container">
                <div class="form-header">
                    <button onclick="backToAuth()" class="btn-back">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <h2><i class="fas fa-sign-in-alt"></i> Welcome Back</h2>
                    <p>Login to your NEMSU Chow Zone account</p>
                </div>

                <div class="form-content">
                    <form id="login-form" onsubmit="loginUser(event)">
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="login-email" placeholder="your@gmail.com" required>
                        </div>

                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="login-password" required>
                        </div>

                        <div style="margin-top: 1rem; text-align: center;">
                            <span class="db-status" id="db-status">
                                <i class="fas fa-database"></i> Database: Checking...
                            </span>
                        </div>

                        <button type="submit" class="btn-primary" style="width: 100%; padding: 1rem; margin-top: 1rem;">
                            <i class="fas fa-sign-in-alt"></i> Login to Account
                        </button>
                        
                        <p style="margin-top: 1rem; text-align: center;">
                            Don't have an account? <a href="#" onclick="showRegister()" style="color: var(--primary);">Register here</a>
                        </p>
                        <p style="text-align: center; margin-top: 0.5rem;">
                            <a href="#" onclick="continueAsGuest()" style="color: var(--primary);">Continue as guest</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>

        <div id="admin-dashboard" class="screen hidden">
            <div class="admin-container">
                <header class="admin-header">
                    <div class="header-left">
                        <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
                        <p style="color: var(--gray-600); font-size: 0.9rem;">Manage NEMSU Chow Zone System</p>
                    </div>
                    
                    <div class="header-right">
                        <span class="db-status connected" id="dashboard-db-status">
                            <i class="fas fa-database"></i> Database: Connected
                        </span>
                        <button onclick="syncDatabase()" class="btn-primary btn-sm">
                            <i class="fas fa-sync"></i> Sync
                        </button>
                        <button onclick="exportData()" class="btn-success btn-sm">
                            <i class="fas fa-download"></i> Export JSON
                        </button>
                        <button onclick="exportToSQLite()" class="btn-success btn-sm">
                            <i class="fas fa-database"></i> Export SQL
                        </button>
                        <button onclick="adminLogout()" class="btn-danger">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </header>

                <div class="admin-content">
                    <div class="admin-welcome-msg">
                        <div>
                            <h3><i class="fas fa-user-shield"></i> Welcome, Admin!</h3>
                            <p>Manage all registered accounts and system data</p>
                        </div>
                        <button onclick="showAllUsers()" class="btn-warning">
                            <i class="fas fa-users"></i> View All Accounts
                        </button>
                    </div>

                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--primary);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-users">0</h3>
                                <p>Total Users</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--secondary);">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="active-users">0</h3>
                                <p>Active Users</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--warning);">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="student-count">0</h3>
                                <p>Students</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: var(--info);">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="instructor-count">0</h3>
                                <p>Instructors</p>
                            </div>
                        </div>
                    </div>

                    <div class="admin-tabs">
                        <button class="admin-tab active" onclick="showTab('accounts', event)">
                            <i class="fas fa-users"></i> All Accounts
                        </button>
                        <button class="admin-tab" onclick="showTab('orders', event)">
                            <i class="fas fa-shopping-cart"></i> Orders
                        </button>
                        <button class="admin-tab" onclick="showTab('inventory', event)">
                            <i class="fas fa-boxes"></i> Inventory
                        </button>
                        <button class="admin-tab" onclick="showTab('analytics', event)">
                            <i class="fas fa-chart-line"></i> Analytics
                        </button>
                    </div>

                    <div class="tab-content">
                        <div id="accounts-tab" class="tab-pane active">
                            <div class="filter-controls">
                                <select id="account-filter-role" onchange="filterAccounts()">
                                    <option value="all">All Roles</option>
                                    <option value="student">Students</option>
                                    <option value="instructor">Instructors</option>
                                    <option value="admin">Admins</option>
                                </select>
                                <select id="account-filter-status" onchange="filterAccounts()">
                                    <option value="all">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                                <button onclick="refreshAccounts()" class="btn-primary btn-sm">
                                    <i class="fas fa-sync"></i> Refresh
                                </button>
                                <button onclick="exportAccounts()" class="btn-success btn-sm">
                                    <i class="fas fa-file-export"></i> Export Accounts
                                </button>
                            </div>
                            
                            <div class="search-bar">
                                <input type="text" id="account-search" placeholder="Search accounts by name, email, or phone..." onkeyup="searchAccounts()">
                            </div>
                            
                            <div style="overflow-x: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Role</th>
                                            <th>Course/Dept</th>
                                            <th>Status</th>
                                            <th>Registered</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="accounts-table-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="orders-tab" class="tab-pane">
                            <h3 style="margin-bottom: 1rem;">Order History</h3>
                            <div class="search-bar">
                                <input type="text" id="order-search" placeholder="Search orders by ID, customer, or status..." onkeyup="searchOrders()">
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Items</th>
                                            <th>Total</th>
                                            <th>Payment</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orders-table-body">
                                    </tbody>
                                </table>
                            </div>
                            <div class="order-history" id="order-history-section">
                                <h4 style="margin-bottom: 1rem;">Recent Order History</h4>
                                <div id="order-history-list">
                                </div>
                            </div>
                        </div>

                        <div id="inventory-tab" class="tab-pane">
                            <h3 style="margin-bottom: 1rem;">Food Inventory Management</h3>
                            <div class="search-bar">
                                <input type="text" id="inventory-search" placeholder="Search inventory by item name or store..." onkeyup="searchInventory()">
                            </div>
                            <div style="overflow-x: auto;">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Store</th>
                                            <th>Item Name</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Stack Display</th>
                                            <th>Status</th>
                                            <th>Last Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventory-table-body">
                                    </tbody>
                                </table>
                            </div>
                            <button onclick="updateAllInventory()" class="btn-primary" style="margin-top: 1rem;">
                                <i class="fas fa-sync"></i> Update All Inventory
                            </button>
                            <button onclick="addNewInventoryItem()" class="btn-success" style="margin-top: 1rem; margin-left: 0.5rem;">
                                <i class="fas fa-plus"></i> Add New Item
                            </button>
                        </div>

                        <div id="analytics-tab" class="tab-pane">
                            <div class="form-grid" style="margin-bottom: 2rem;">
                                <div class="form-group">
                                    <label>Date Range</label>
                                    <select id="analytics-range" onchange="updateAnalytics()">
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month" selected>This Month</option>
                                        <option value="year">This Year</option>
                                        <option value="all">All Time</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Report Type</label>
                                    <select id="analytics-type" onchange="updateAnalytics()">
                                        <option value="sales">Sales Report</option>
                                        <option value="users">User Growth</option>
                                        <option value="popular">Popular Items</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="chart-container">
                                <canvas id="analyticsChart"></canvas>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
                                <div style="background: white; padding: 1.5rem; border-radius: var(--radius); box-shadow: var(--shadow);">
                                    <h3 style="margin-bottom: 1rem;">Top Selling Items</h3>
                                    <div id="top-items-list">
                                    </div>
                                </div>
                                <div style="background: white; padding: 1.5rem; border-radius: var(--radius); box-shadow: var(--shadow);">
                                    <h3 style="margin-bottom: 1rem;">Recent Activity</h3>
                                    <div id="recent-activity">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="stores-screen" class="screen hidden">
            <div class="stores-container">
                <header class="stores-header">
                    <div class="header-left">
                        <div class="header-title">
                            <h1><i class="fas fa-store"></i> CHOWZONE STORES</h1>
                            <p style="color: var(--gray-600); font-size: 0.9rem;">Browse our campus food vendors</p>
                        </div>
                    </div>
                    
                    <div class="header-right">
                        <div class="user-profile">
                            <div class="avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-info">
                                <span class="user-name" id="user-name">Guest User</span>
                                <span class="user-role" id="user-role">Guest</span>
                            </div>
                        </div>
                        
                        <button onclick="viewCart()" class="btn-cart">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="cart-count" id="cart-count">0</span>
                        </button>
                        
                        <button onclick="logout()" class="btn-logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </header>

                <div class="stores-content">
                    <div class="stores-grid" id="stores-list">
                    </div>
                </div>
            </div>
        </div>

        <div id="menu-screen" class="screen hidden">
            <div class="menu-container">
                <header class="menu-header">
                    <button onclick="backToStores()" class="btn-back">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="header-content">
                        <h1 id="store-name">Store Name</h1>
                        <div class="store-meta">
                            <span class="rating">
                                <i class="fas fa-star"></i> 4.5
                            </span>
                            <span class="status open">
                                <i class="fas fa-circle"></i> Open
                            </span>
                            <span class="delivery-time">
                                <i class="fas fa-clock"></i> 15-20 mins
                            </span>
                        </div>
                    </div>
                    <button onclick="viewCart()" class="btn-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="menu-cart-count">0</span>
                    </button>
                </header>

                <div class="menu-content">
                    <div class="store-banner">
                        <div class="banner-content">
                            <div class="store-icon-large" id="store-icon">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="store-info">
                                <p id="store-description">Store description goes here</p>
                                <div class="store-tags">
                                    <span class="tag" id="store-category">Category</span>
                                    <span class="tag" id="store-price-range"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="menu-items" id="menu-list">
                    </div>
                </div>
            </div>
        </div>

        <div id="cart-screen" class="screen hidden">
            <div class="cart-container">
                <header class="cart-header">
                    <button onclick="backToMenu()" class="btn-back">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1><i class="fas fa-shopping-cart"></i> Your Order</h1>
                    <button onclick="clearCart()" class="btn-clear">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </header>

                <div class="cart-content">
                    <div class="cart-items" id="cart-items">
                    </div>
                    
                    <div class="cart-summary">
                        <div class="summary-section">
                            <h3>Order Summary</h3>
                            <div class="summary-row">
                                <span>Subtotal</span>
                                <span id="cart-subtotal">0.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Delivery Fee</span>
                                <span id="delivery-fee">20.00</span>
                            </div>
                            <div class="summary-row">
                                <span>Service Fee</span>
                                <span id="service-fee">5.00</span>
                            </div>
                            <div class="summary-row total">
                                <span>Total Amount</span>
                                <span id="cart-total">0.00</span>
                            </div>
                        </div>
                        
                        <button onclick="checkout()" class="btn-primary btn-checkout">
                            <i class="fas fa-credit-card"></i> Proceed to Checkout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="checkout-screen" class="screen hidden">
            <div class="checkout-container">
                <header class="checkout-header">
                    <button onclick="backToCart()" class="btn-back">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h1><i class="fas fa-credit-card"></i> Checkout</h1>
                </header>

                <div class="checkout-content">
                    <div class="checkout-form">
                        <form id="checkout-form" onsubmit="placeOrder(event)">
                            <div class="form-section">
                                <h3><i class="fas fa-phone"></i> Contact Information</h3>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Phone Number <span class="required">*</span></label>
                                        <input type="tel" id="checkout-phone" pattern="09[0-9]{9}" placeholder="09123456789" required>
                                        <small class="form-text">For delivery updates</small>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-wallet"></i> Payment Method</h3>
                                <div class="payment-options">
                                    <div class="payment-option active" onclick="selectPayment('gcash')">
                                        <div class="option-header">
                                            <div class="option-icon">
                                                <i class="fas fa-mobile-alt"></i>
                                            </div>
                                            <div class="option-info">
                                                <span class="option-title">GCash</span>
                                                <span class="option-subtitle">Pay via GCash</span>
                                            </div>
                                            <div class="option-check">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                        </div>
                                        <div class="option-details">
                                            <div class="form-group">
                                                <label>GCash Mobile Number <span class="required">*</span></label>
                                                <input type="tel" id="gcash-number" pattern="09[0-9]{9}" placeholder="09123456789">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="payment-option" onclick="selectPayment('paymaya')">
                                        <div class="option-header">
                                            <div class="option-icon">
                                                <i class="fas fa-credit-card"></i>
                                            </div>
                                            <div class="option-info">
                                                <span class="option-title">PayMaya</span>
                                                <span class="option-subtitle">Pay via PayMaya Wallet</span>
                                            </div>
                                            <div class="option-check">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                        </div>
                                        <div class="option-details">
                                            <div class="form-group">
                                                <label>PayMaya Wallet Number <span class="required">*</span></label>
                                                <input type="tel" id="paymaya-number" pattern="09[0-9]{9}" placeholder="09123456789">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="payment-option" onclick="selectPayment('cod')">
                                        <div class="option-header">
                                            <div class="option-icon">
                                                <i class="fas fa-money-bill-wave"></i>
                                            </div>
                                            <div class="option-info">
                                                <span class="option-title">Cash on Delivery</span>
                                                <span class="option-subtitle">Pay when you receive</span>
                                            </div>
                                            <div class="option-check">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h3><i class="fas fa-map-marker-alt"></i> Delivery Address</h3>
                                <div class="form-group">
                                    <label>Address <span class="required">*</span></label>
                                    <textarea id="delivery-address" rows="3" placeholder="Enter your delivery address..." required></textarea>
                                </div>
                            </div>

                            <div class="button-group">
                                <button type="button" class="btn-secondary btn-back" onclick="backToCart()">
                                    <i class="fas fa-arrow-left"></i> Back to Cart
                                </button>
                                <button type="submit" class="btn-primary">
                                    <i class="fas fa-check-circle"></i> Place Order
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div id="receipt-screen" class="screen hidden">
            <div class="receipt-container">
                <div class="receipt">
                    <div class="receipt-header">
                        <div class="receipt-logo">
                            <i class="fas fa-utensils"></i>
                            <h2>NEMSU CHOW ZONE</h2>
                        </div>
                        <p style="opacity: 0.9;">Food Ordering System</p>
                        <p class="receipt-order-id">Order #<span id="order-id">123456</span></p>
                    </div>
                    
                    <div class="receipt-body">
                        <div class="receipt-info">
                            <div class="info-row">
                                <span class="label">Date:</span>
                                <span id="receipt-date">Nov 30, 2023 14:30</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Customer:</span>
                                <span id="receipt-customer">John Doe</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Phone:</span>
                                <span id="receipt-phone">09123456789</span>
                            </div>
                        </div>
                        
                        <div class="receipt-items" id="receipt-items">
                        </div>
                        
                        <div class="receipt-totals">
                            <div class="total-row">
                                <span>Subtotal:</span>
                                <span id="receipt-subtotal">0.00</span>
                            </div>
                            <div class="total-row">
                                <span>Delivery Fee:</span>
                                <span id="receipt-delivery">20.00</span>
                            </div>
                            <div class="total-row">
                                <span>Service Fee:</span>
                                <span id="receipt-service">5.00</span>
                            </div>
                            <div class="total-row grand-total">
                                <span>Total Amount:</span>
                                <span id="receipt-total">0.00</span>
                            </div>
                        </div>
                        
                        <div class="receipt-footer">
                            <div class="info-row">
                                <span class="label">Payment Method:</span>
                                <span id="receipt-payment">GCash</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Payment Number:</span>
                                <span id="receipt-payment-number">09123456789</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Status:</span>
                                <span style="color: var(--secondary); font-weight: 600;">CONFIRMED</span>
                            </div>
                            <div class="info-row">
                                <span class="label">Delivery:</span>
                                <span>20-30 minutes</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="receipt-actions">
                        <button onclick="printReceipt()" class="btn-primary">
                            <i class="fas fa-print"></i> Print Receipt
                        </button>
                        <button onclick="newOrder()" class="btn-secondary">
                            <i class="fas fa-utensils"></i> New Order
                        </button>
                        <button onclick="saveToDatabase()" class="btn-success">
                            <i class="fas fa-save"></i> Save to DB
                        </button>
                    </div>
                    
                    <div class="receipt-thanks">
                        <p>Thank you for ordering from NEMSU Chow Zone!</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="edit-account-modal" class="edit-modal hidden">
            <div class="edit-modal-content">
                <h3><i class="fas fa-edit"></i> Edit Account</h3>
                <form id="edit-account-form" onsubmit="saveAccountChanges(event)">
                    <input type="hidden" id="edit-account-id">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label>First Name <span class="required">*</span></label>
                            <input type="text" id="edit-first-name" required>
                        </div>
                        <div class="form-group">
                            <label>Last Name <span class="required">*</span></label>
                            <input type="text" id="edit-last-name" required>
                        </div>
                        <div class="form-group">
                            <label>Middle Name</label>
                            <input type="text" id="edit-middle-name">
                        </div>
                        <div class="form-group">
                            <label>Age <span class="required">*</span></label>
                            <input type="number" id="edit-age" min="15" max="80" required>
                        </div>
                        <div class="form-group">
                            <label>Phone <span class="required">*</span></label>
                            <input type="tel" id="edit-phone" pattern="09[0-9]{9}" required>
                        </div>
                        <div class="form-group">
                            <label>Email <span class="required">*</span></label>
                            <input type="email" id="edit-email" required>
                        </div>
                        <div class="form-group">
                            <label>Role <span class="required">*</span></label>
                            <select id="edit-role" required onchange="toggleEditRoleFields()">
                                <option value="student">Student</option>
                                <option value="instructor">Instructor</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Status <span class="required">*</span></label>
                            <select id="edit-status" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group" id="edit-course-field">
                            <label>Course <span class="required">*</span></label>
                            <select id="edit-course">
                                <option value="">Select Course</option>
                                <option value="BSIT">BS Information Technology</option>
                                <option value="BSCS">BS Computer Science</option>
                                <option value="BSIS">BS Information Systems</option>
                                <option value="BSEd">BS Education</option>
                                <option value="BSBA">BS Business Administration</option>
                            </select>
                        </div>
                        <div class="form-group" id="edit-department-field" style="display: none;">
                            <label>Department <span class="required">*</span></label>
                            <select id="edit-department">
                                <option value="">Select Department</option>
                                <option value="CCS">College of Computer Studies</option>
                                <option value="CIT">College of Industrial Technology</option>
                                <option value="CEA">College of Engineering & Architecture</option>
                                <option value="CBEAS">College of Business, Economics & Accountancy</option>
                                <option value="CTE">College of Teacher Education</option>
                                <option value="CON">College of Nursing</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Account Notes</label>
                        <textarea id="edit-notes" rows="3" placeholder="Add any notes about this account..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button type="button" onclick="closeEditModal()" class="btn-secondary">
                            Cancel
                        </button>
                        <button type="button" onclick="resetPassword()" class="btn-warning">
                            <i class="fas fa-key"></i> Reset Password
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div id="alert-modal" class="modal hidden">
            <div class="modal-content">
                <div class="alert-icon" id="alert-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 id="alert-title">Success</h3>
                <p id="alert-message">Operation completed successfully</p>
                <button onclick="closeAlert()" class="btn-primary" style="width: 100%; padding: 0.75rem;">OK</button>
            </div>
        </div>

        <div id="guest-restriction-modal" class="guest-restriction-modal hidden">
            <div class="guest-restriction-content">
                <div class="guest-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <h3 id="guest-alert-title">Registration Required</h3>
                <p id="guest-alert-message">Guest users can only browse stores and view menu items. To place an order, please register or login first.</p>
                <div class="guest-buttons">
                    <button onclick="showRegister()" class="btn-primary">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                    <button onclick="showLogin()" class="btn-success">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    <button onclick="closeGuestRestriction()" class="btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>
        </div>

        <div id="registration-success-modal" class="registration-success-modal hidden">
            <div class="registration-success-content">
                <div class="registration-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3 id="registration-title">Registration Successful!</h3>
                <p id="registration-message">Account created successfully. What would you like to do next?</p>
                <div class="registration-buttons">
                    <button onclick="proceedToLogin()" class="btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Login Now
                    </button>
                    <button onclick="backToWelcomeFromRegistration()" class="btn-secondary">
                        <i class="fas fa-home"></i> Back to Home
                    </button>
                    <button onclick="exitApp()" class="btn-danger">
                        <i class="fas fa-sign-out-alt"></i> Exit System
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let cart = [];
        let currentStore = null;
        let selectedPayment = 'gcash';
        let userRole = 'student';
        let isDatabaseConnected = false;
        let salesChart = null;
        let analyticsChart = null;
        let isGuestMode = false;
        let isAdminLoggedIn = false;
        let db = null;

        // Minesweeper game variables
        let minesweeperGame = {
            rows: 10,
            cols: 10,
            mines: 10,
            board: [],
            revealed: [],
            flagged: [],
            gameOver: false,
            gameWon: false,
            firstMove: true,
            startTime: null,
            timerInterval: null,
            flagMode: false,
            hints: 3,
            difficulty: 'beginner'
        };

        // Database configuration
        const DB_NAME = 'NEMSU_FOOD_DB';
        const DB_VERSION = 6;

        // Store data
        const stores = [
            {
                id: 1,
                name: "SWEET CORNER",
                icon: "fas fa-candy-cane",
                description: "Sweet corn delicacies and desserts",
                category: "desserts",
                rating: 4.5,
                status: "open",
                deliveryTime: "15-20 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Mais Con Yellow", price: 25, description: "Sweet yellow corn with butter", stock: 50 },
                    { id: 2, name: "Sweet Corn Pudding and Cakes", price: 30, description: "Soft corn pudding with cake", stock: 30 },
                    { id: 3, name: "Sweetcorn Popcorn", price: 20, description: "Freshly popped sweet corn", stock: 100 },
                    { id: 4, name: "Chao Fan Sweetcorn Rice", price: 40, description: "Fried rice with sweet corn", stock: 25 }
                ]
            },
            {
                id: 2,
                name: "JAC N' JELL FOOD HOUSE",
                icon: "fas fa-utensils",
                description: "Rice meals and refreshing drinks",
                category: "fastfood",
                rating: 4.3,
                status: "open",
                deliveryTime: "20-25 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Siomai Rice with Bagoong", price: 45, description: "Steamed siomai with shrimp paste rice", stock: 40 },
                    { id: 2, name: "Lemonade Juice", price: 20, description: "Freshly squeezed lemonade", stock: 80 },
                    { id: 3, name: "Sandwich Bread", price: 25, description: "Fresh sandwich with fillings", stock: 35 }
                ]
            },
            {
                id: 3,
                name: "FRESH FRUIT SALAD & SHAKE",
                icon: "fas fa-blender",
                description: "Healthy fruit options and shakes",
                category: "drinks",
                rating: 4.7,
                status: "open",
                deliveryTime: "10-15 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Fruit Shake", price: 35, description: "Mixed fruit shake", stock: 60 }
                ]
            },
            {
                id: 4,
                name: "TUHOG CORNER",
                icon: "fas fa-drumstick-bite",
                description: "Street food favorites on sticks",
                category: "snacks",
                rating: 4.2,
                status: "open",
                deliveryTime: "15-20 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Fried Isaw", price: 10, description: "Grilled chicken intestines", stock: 200 },
                    { id: 2, name: "Baga", price: 10, description: "Grilled pork lungs", stock: 150 },
                    { id: 3, name: "Hotdog", price: 15, description: "Grilled hotdog on stick", stock: 120 },
                    { id: 4, name: "Siomai", price: 20, description: "Steamed pork siomai", stock: 90 },
                    { id: 5, name: "Fried Shanghai", price: 25, description: "Deep fried spring rolls", stock: 75 }
                ]
            },
            {
                id: 5,
                name: "SHAWARMA",
                icon: "fas fa-bread-slice",
                description: "Middle eastern delight wrapped in pita",
                category: "fastfood",
                rating: 4.6,
                status: "open",
                deliveryTime: "20-25 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Shawarma", price: 60, description: "Chicken shawarma with garlic sauce", stock: 45 }
                ]
            },
            {
                id: 6,
                name: "IL RUTTO",
                icon: "fas fa-ice-cream",
                description: "Desserts and savory snacks",
                category: "desserts",
                rating: 4.4,
                status: "open",
                deliveryTime: "15-20 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Soft Serve Ice Cream and Snacks", price: 30, description: "Vanilla soft serve with toppings", stock: 50 },
                    { id: 2, name: "Burger and Fries", price: 55, description: "Beef burger with potato fries", stock: 30 }
                ]
            },
            {
                id: 7,
                name: "DOUBLE G STREET FOODS",
                icon: "fas fa-fish",
                description: "Quick street bites and snacks",
                category: "snacks",
                rating: 4.1,
                status: "open",
                deliveryTime: "10-15 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Kikiam", price: 10, description: "Deep fried fish rolls", stock: 180 },
                    { id: 2, name: "Fishball", price: 10, description: "Fried fish balls with sauce", stock: 200 }
                ]
            },
            {
                id: 8,
                name: "ELMA'S TAKOYAKI & JAPANESE CAKE",
                icon: "fas fa-birthday-cake",
                description: "Japanese street food specialties",
                category: "snacks",
                rating: 4.8,
                status: "open",
                deliveryTime: "20-25 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Takoyaki", price: 40, description: "Octopus balls with sauce", stock: 40 },
                    { id: 2, name: "Japanese Cake", price: 20, description: "Soft Japanese sponge cake", stock: 65 }
                ]
            },
            {
                id: 9,
                name: "ENJOY KIDDOS' HUB",
                icon: "fas fa-hamburger",
                description: "Family favorites and comfort food",
                category: "fastfood",
                rating: 4.5,
                status: "open",
                deliveryTime: "25-30 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Pastil", price: 20, description: "Shredded chicken with rice", stock: 55 },
                    { id: 2, name: "Fried Chicken", price: 60, description: "Crispy fried chicken", stock: 35 },
                    { id: 3, name: "Chicken Curry", price: 70, description: "Spicy chicken curry", stock: 25 },
                    { id: 4, name: "Humba", price: 65, description: "Braised pork belly", stock: 20 },
                    { id: 5, name: "Hot Cake", price: 15, description: "Fluffy pancakes", stock: 70 }
                ]
            },
            {
                id: 10,
                name: "TAG'Z FRUIT",
                icon: "fas fa-apple-alt",
                description: "Fresh fruit slices and salads",
                category: "snacks",
                rating: 4.9,
                status: "open",
                deliveryTime: "10-15 mins",
                priceRange: "",
                menu: [
                    { id: 1, name: "Manga Slice", price: 20, description: "Fresh mango slices", stock: 85 },
                    { id: 2, name: "Pinya Slice", price: 25, description: "Sweet pineapple slices", stock: 60 },
                    { id: 3, name: "Bayabas Slice", price: 15, description: "Guava slices", stock: 45 },
                    { id: 4, name: "Santol Slice", price: 20, description: "Santol fruit slices", stock: 30 }
                ]
            }
        ];

        // ==================== DATABASE FUNCTIONS ====================

        async function initDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = (event) => {
                    console.error('Database error:', event.target.error);
                    updateDatabaseStatus(false);
                    reject(event.target.error);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    updateDatabaseStatus(true);
                    
                    // Check if default data exists
                    const transaction = db.transaction(['stores'], 'readonly');
                    const objectStore = transaction.objectStore('stores');
                    const countRequest = objectStore.count();
                    
                    countRequest.onsuccess = () => {
                        if (countRequest.result === 0) {
                            initializeDefaultData();
                        }
                        resolve(db);
                    };
                    
                    countRequest.onerror = () => {
                        initializeDefaultData();
                        resolve(db);
                    };
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    // Create object stores if they don't exist
                    if (!db.objectStoreNames.contains('users')) {
                        const usersStore = db.createObjectStore('users', { keyPath: 'id', autoIncrement: true });
                        usersStore.createIndex('email', 'email', { unique: true });
                        usersStore.createIndex('role', 'role', { unique: false });
                        usersStore.createIndex('status', 'status', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('orders')) {
                        const ordersStore = db.createObjectStore('orders', { keyPath: 'id', autoIncrement: true });
                        ordersStore.createIndex('customerId', 'customerId', { unique: false });
                        ordersStore.createIndex('date', 'date', { unique: false });
                        ordersStore.createIndex('status', 'status', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('stores')) {
                        const storesStore = db.createObjectStore('stores', { keyPath: 'id' });
                        storesStore.createIndex('name', 'name', { unique: true });
                    }
                    
                    if (!db.objectStoreNames.contains('inventory')) {
                        const inventoryStore = db.createObjectStore('inventory', { keyPath: 'id', autoIncrement: true });
                        inventoryStore.createIndex('storeId', 'storeId', { unique: false });
                        inventoryStore.createIndex('itemName', 'itemName', { unique: false });
                        inventoryStore.createIndex('stock', 'stock', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('orderItems')) {
                        const orderItemsStore = db.createObjectStore('orderItems', { keyPath: 'id', autoIncrement: true });
                        orderItemsStore.createIndex('orderId', 'orderId', { unique: false });
                        orderItemsStore.createIndex('itemId', 'itemId', { unique: false });
                    }
                };
            });
        }

        function initializeDefaultData() {
            if (!db) return;
            
            const transaction = db.transaction(['stores', 'inventory', 'users'], 'readwrite');
            
            // Add stores
            const storeStore = transaction.objectStore('stores');
            stores.forEach(store => {
                const storeData = {
                    id: store.id,
                    name: store.name,
                    icon: store.icon,
                    description: store.description,
                    category: store.category,
                    rating: store.rating,
                    status: store.status,
                    deliveryTime: store.deliveryTime,
                    priceRange: store.priceRange
                };
                storeStore.add(storeData);
            });
            
            // Add inventory items
            const inventoryStore = transaction.objectStore('inventory');
            stores.forEach(store => {
                store.menu.forEach(item => {
                    const inventoryItem = {
                        storeId: store.id,
                        storeName: store.name,
                        itemId: item.id,
                        itemName: item.name,
                        price: item.price,
                        description: item.description,
                        stock: item.stock,
                        minStock: 10,
                        maxStock: 100,
                        lastUpdated: new Date().toISOString(),
                        status: item.stock > 20 ? 'In Stock' : item.stock > 10 ? 'Low Stock' : 'Out of Stock'
                    };
                    inventoryStore.add(inventoryItem);
                });
            });
            
            // Add admin user
            const userStore = transaction.objectStore('users');
            const adminUser = {
                firstName: 'Admin',
                lastName: 'User',
                email: 'admin@gmail.com',
                password: 'admin123',
                role: 'admin',
                status: 'active',
                phone: '09123456789',
                age: 30,
                registrationDate: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            userStore.add(adminUser);
        }

        function updateDatabaseStatus(connected) {
            isDatabaseConnected = connected;
            const statusElement = document.getElementById('db-status');
            const dashboardStatus = document.getElementById('dashboard-db-status');
            
            if (connected) {
                statusElement.className = 'db-status connected';
                statusElement.innerHTML = '<i class="fas fa-database"></i> Database: Connected';
                dashboardStatus.className = 'db-status connected';
                dashboardStatus.innerHTML = '<i class="fas fa-database"></i> Database: Connected';
            } else {
                statusElement.className = 'db-status disconnected';
                statusElement.innerHTML = '<i class="fas fa-database"></i> Database: Disconnected';
                dashboardStatus.className = 'db-status disconnected';
                dashboardStatus.innerHTML = '<i class="fas fa-database"></i> Database: Disconnected';
            }
        }

        async function addToDatabase(storeName, data) {
            if (!db) return null;
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const objectStore = transaction.objectStore(storeName);
                const request = objectStore.add(data);
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function getAllFromDatabase(storeName) {
            if (!db) return [];
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readonly');
                const objectStore = transaction.objectStore(storeName);
                const request = objectStore.getAll();
                
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }

        async function updateInDatabase(storeName, id, data) {
            if (!db) return;
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const objectStore = transaction.objectStore(storeName);
                const getRequest = objectStore.get(id);
                
                getRequest.onsuccess = () => {
                    const existing = getRequest.result;
                    const updated = { ...existing, ...data };
                    const updateRequest = objectStore.put(updated);
                    
                    updateRequest.onsuccess = () => resolve(updateRequest.result);
                    updateRequest.onerror = () => reject(updateRequest.error);
                };
                
                getRequest.onerror = () => reject(getRequest.error);
            });
        }

        async function deleteFromDatabase(storeName, id) {
            if (!db) return;
            
            return new Promise((resolve, reject) => {
                const transaction = db.transaction([storeName], 'readwrite');
                const objectStore = transaction.objectStore(storeName);
                const request = objectStore.delete(id);
                
                request.onsuccess = () => resolve(true);
                request.onerror = () => reject(request.error);
            });
        }

        // ==================== ENHANCED ORDER MANAGEMENT ====================

        async function saveOrderToDatabase(order) {
            if (!db) {
                // Fallback to localStorage
                const orders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                orders.push(order);
                localStorage.setItem('nemsuOrders', JSON.stringify(orders));
                return order.id;
            }
            
            try {
                // Save order
                const orderId = await addToDatabase('orders', order);
                
                // Save order items
                const transaction = db.transaction(['orderItems'], 'readwrite');
                const orderItemsStore = transaction.objectStore('orderItems');
                
                order.items.forEach(item => {
                    const orderItem = {
                        orderId: orderId,
                        storeId: item.storeId,
                        storeName: item.storeName,
                        itemId: item.itemId,
                        itemName: item.itemName,
                        price: item.price,
                        quantity: item.quantity,
                        subtotal: item.price * item.quantity
                    };
                    orderItemsStore.add(orderItem);
                    
                    // Update inventory stock
                    updateInventoryStock(item.storeId, item.itemId, -item.quantity);
                });
                
                return orderId;
            } catch (error) {
                console.error('Error saving order:', error);
                // Fallback to localStorage
                const orders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                order.id = 'NEMSU' + Date.now().toString().slice(-8);
                orders.push(order);
                localStorage.setItem('nemsuOrders', JSON.stringify(orders));
                return order.id;
            }
        }

        async function updateInventoryStock(storeId, itemId, quantityChange) {
            try {
                if (!db) return;
                
                const inventory = await getAllFromDatabase('inventory');
                const item = inventory.find(i => i.storeId === storeId && i.itemId === itemId);
                
                if (item) {
                    const newStock = Math.max(0, item.stock + quantityChange);
                    const status = newStock > 20 ? 'In Stock' : newStock > 10 ? 'Low Stock' : 'Out of Stock';
                    
                    await updateInDatabase('inventory', item.id, {
                        stock: newStock,
                        status: status,
                        lastUpdated: new Date().toISOString()
                    });
                }
            } catch (error) {
                console.error('Error updating inventory:', error);
            }
        }

        async function getAllOrdersWithItems() {
            try {
                const orders = await getAllFromDatabase('orders');
                const orderItems = await getAllFromDatabase('orderItems');
                
                // Combine orders with their items
                return orders.map(order => ({
                    ...order,
                    items: orderItems.filter(item => item.orderId === order.id)
                }));
            } catch (error) {
                console.error('Error getting orders with items:', error);
                return JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
            }
        }

        // ==================== ADMIN FUNCTIONS ====================

        async function loadDashboardData() {
            try {
                // Load orders
                const orders = await getAllOrdersWithItems();
                renderOrdersTable(orders);
                
                // Load inventory
                const inventory = await getAllFromDatabase('inventory');
                renderInventoryTable(inventory);
                
                // Update statistics
                updateStatistics(orders, inventory);
                
                // Load recent orders for history
                loadOrderHistory(orders);
                
                // Update analytics
                updateAnalytics();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        function updateStatistics(orders, inventory) {
            // Total users (from localStorage as fallback)
            const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
            document.getElementById('total-users').textContent = users.length;
            
            // Active users
            const activeUsers = users.filter(u => u.status === 'active').length;
            document.getElementById('active-users').textContent = activeUsers;
            
            // Student count
            const studentCount = users.filter(u => u.role === 'student').length;
            document.getElementById('student-count').textContent = studentCount;
            
            // Instructor count
            const instructorCount = users.filter(u => u.role === 'instructor').length;
            document.getElementById('instructor-count').textContent = instructorCount;
            
            // Update other stats if elements exist
            const totalOrdersEl = document.getElementById('total-orders');
            const totalStoresEl = document.getElementById('total-stores');
            const totalRevenueEl = document.getElementById('total-revenue');
            
            if (totalOrdersEl) totalOrdersEl.textContent = orders.length;
            if (totalStoresEl) totalStoresEl.textContent = stores.length;
            
            if (totalRevenueEl) {
                const totalRevenue = orders.reduce((sum, order) => sum + (order.total || 0), 0);
                totalRevenueEl.textContent = `${totalRevenue.toFixed(2)}`;
            }
        }

        function renderInventoryTable(inventory) {
            const tbody = document.getElementById('inventory-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (!inventory || inventory.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-boxes fa-2x" style="color: var(--gray-400); margin-bottom: 1rem;"></i>
                            <p>No inventory items found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            inventory.forEach(item => {
                const maxStock = item.maxStock || 100;
                const percentage = Math.min(100, (item.stock / maxStock) * 100);
                const stackClass = item.stock > 20 ? '' : item.stock > 10 ? 'low' : 'critical';
                const statusClass = item.stock > 20 ? 'badge-success' : 
                                   item.stock > 10 ? 'badge-warning' : 'badge-danger';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.storeName}</td>
                    <td>${item.itemName}</td>
                    <td>${item.price.toFixed(2)}</td>
                    <td>
                        <input type="number" 
                               value="${item.stock}" 
                               min="0" 
                               max="${maxStock}"
                               class="stock-input" 
                               data-id="${item.id}"
                               style="width: 70px; padding: 0.25rem; border: 1px solid var(--gray-300); border-radius: var(--radius-sm);">
                    </td>
                    <td>
                        <div class="stack-display">
                            <div class="stack-bar">
                                <div class="stack-fill ${stackClass}" style="width: ${percentage}%"></div>
                            </div>
                            <span>${item.stock} units</span>
                        </div>
                    </td>
                    <td><span class="badge ${statusClass}">${item.status}</span></td>
                    <td>${new Date(item.lastUpdated).toLocaleDateString()}</td>
                    <td>
                        <button onclick="updateStock(${item.id})" class="btn-edit">
                            <i class="fas fa-save"></i> Update
                        </button>
                        <button onclick="restockItem(${item.id})" class="btn-activate">
                            <i class="fas fa-box"></i> Restock
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function updateStock(inventoryId) {
            const input = document.querySelector(`.stock-input[data-id="${inventoryId}"]`);
            if (!input) return;
            
            const newStock = parseInt(input.value);
            if (isNaN(newStock) || newStock < 0) {
                showAlert('Invalid Input', 'Please enter a valid stock quantity', 'error');
                return;
            }
            
            try {
                if (!db) throw new Error('Database not connected');
                
                await updateInDatabase('inventory', inventoryId, {
                    stock: newStock,
                    status: newStock > 20 ? 'In Stock' : newStock > 10 ? 'Low Stock' : 'Out of Stock',
                    lastUpdated: new Date().toISOString()
                });
                
                showAlert('Success', 'Stock updated successfully!', 'success');
                loadDashboardData();
                
            } catch (error) {
                console.error('Error updating stock:', error);
                showAlert('Error', 'Failed to update stock: ' + error.message, 'error');
            }
        }

        async function restockItem(inventoryId) {
            const restockAmount = prompt('Enter quantity to add:', '10');
            if (!restockAmount || isNaN(restockAmount)) return;
            
            try {
                if (!db) throw new Error('Database not connected');
                
                const inventory = await getAllFromDatabase('inventory');
                const item = inventory.find(i => i.id === inventoryId);
                
                if (item) {
                    const newStock = item.stock + parseInt(restockAmount);
                    const maxStock = item.maxStock || 100;
                    const finalStock = Math.min(newStock, maxStock);
                    const status = finalStock > 20 ? 'In Stock' : finalStock > 10 ? 'Low Stock' : 'Out of Stock';
                    
                    await updateInDatabase('inventory', inventoryId, {
                        stock: finalStock,
                        status: status,
                        lastUpdated: new Date().toISOString()
                    });
                    
                    showAlert('Success', `Item restocked! New stock: ${finalStock}`, 'success');
                    loadDashboardData();
                }
            } catch (error) {
                console.error('Error restocking item:', error);
                showAlert('Error', 'Failed to restock item: ' + error.message, 'error');
            }
        }

        function renderOrdersTable(orders) {
            const tbody = document.getElementById('orders-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (!orders || orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-shopping-cart fa-2x" style="color: var(--gray-400); margin-bottom: 1rem;"></i>
                            <p>No orders found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort orders by date (newest first)
            orders.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            orders.forEach(order => {
                const row = document.createElement('tr');
                const customerName = order.customerName || (order.customer ? 
                    `${order.customer.firstName} ${order.customer.lastName}` : 'Guest');
                const itemsCount = order.items ? order.items.length : 0;
                
                row.innerHTML = `
                    <td>${order.id}</td>
                    <td>${customerName}</td>
                    <td>${itemsCount} items</td>
                    <td>${order.total ? order.total.toFixed(2) : '0.00'}</td>
                    <td>${order.paymentMethod || 'N/A'}</td>
                    <td><span class="badge badge-success">${order.status || 'Completed'}</span></td>
                    <td>${new Date(order.date).toLocaleDateString()}</td>
                    <td>
                        <button onclick="viewOrderDetails(${order.id})" class="btn-edit">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button onclick="printOrderReceipt(${order.id})" class="btn-primary" style="background: var(--primary); margin-left: 0.25rem;">
                            <i class="fas fa-print"></i> Print
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function viewOrderDetails(orderId) {
            try {
                let order = null;
                let items = [];
                
                if (db) {
                    const transaction = db.transaction(['orders', 'orderItems'], 'readonly');
                    const ordersStore = transaction.objectStore('orders');
                    const orderItemsStore = transaction.objectStore('orderItems');
                    
                    // Get order
                    const orderRequest = ordersStore.get(orderId);
                    orderRequest.onsuccess = () => {
                        order = orderRequest.result;
                        
                        // Get order items
                        const itemsRequest = orderItemsStore.index('orderId').getAll(orderId);
                        itemsRequest.onsuccess = () => {
                            items = itemsRequest.result;
                            showOrderDetailsModal(order, items);
                        };
                    };
                } else {
                    // Fallback to localStorage
                    const orders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                    order = orders.find(o => o.id === orderId);
                    if (order) {
                        items = order.items || [];
                        showOrderDetailsModal(order, items);
                    } else {
                        showAlert('Error', 'Order not found!', 'error');
                    }
                }
            } catch (error) {
                console.error('Error viewing order details:', error);
                showAlert('Error', 'Failed to load order details', 'error');
            }
        }

        function showOrderDetailsModal(order, items) {
            let details = `
                <h4>Order #${order.id}</h4>
                <p><strong>Customer:</strong> ${order.customerName || 'Guest'}</p>
                <p><strong>Date:</strong> ${new Date(order.date).toLocaleString()}</p>
                <p><strong>Phone:</strong> ${order.phone || 'N/A'}</p>
                <p><strong>Address:</strong> ${order.address || 'N/A'}</p>
                <p><strong>Payment Method:</strong> ${order.paymentMethod || 'N/A'}</p>
                <p><strong>Total:</strong> ${order.total ? order.total.toFixed(2) : '0.00'}</p>
                <hr>
                <h5>Items (${items.length}):</h5>
                <ul style="list-style: none; padding-left: 0; max-height: 200px; overflow-y: auto;">
            `;
            
            items.forEach(item => {
                details += `
                    <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--gray-200);">
                        ${item.quantity}x ${item.itemName} (${item.storeName})<br>
                        <small>Price: ${item.price.toFixed(2)} each = ${(item.price * item.quantity).toFixed(2)}</small>
                    </li>
                `;
            });
            
            details += `</ul>`;
            
            showAlert('Order Details', details, 'info');
        }

        function printOrderReceipt(orderId) {
            // In a real implementation, this would generate a printable receipt
            showAlert('Print Receipt', 'This would open a printable receipt for order #' + orderId, 'info');
        }

        function loadOrderHistory(orders) {
            const orderHistoryList = document.getElementById('order-history-list');
            if (!orderHistoryList) return;
            
            orderHistoryList.innerHTML = '';
            
            if (!orders || orders.length === 0) {
                orderHistoryList.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <p>No order history available</p>
                    </div>
                `;
                return;
            }
            
            const recentOrders = orders.slice(0, 10); // Show last 10 orders
            
            recentOrders.forEach(order => {
                const orderItem = document.createElement('div');
                orderItem.className = 'order-history-item';
                
                const itemsCount = order.items ? order.items.length : 0;
                const total = order.total ? order.total.toFixed(2) : '0.00';
                const date = new Date(order.date).toLocaleDateString();
                const customerName = order.customerName || 'Guest';
                
                orderItem.innerHTML = `
                    <div>
                        <div style="font-weight: 600;">Order #${order.id}</div>
                        <div style="font-size: 0.875rem; color: var(--gray-500);">${customerName}</div>
                        <div class="order-history-date">${date}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600; color: var(--primary);">${total}</div>
                        <div style="font-size: 0.875rem; color: var(--gray-500);">${itemsCount} items</div>
                        <span class="order-history-status" style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: var(--radius-sm); font-size: 0.75rem;">
                            ${order.status || 'Completed'}
                        </span>
                    </div>
                `;
                orderHistoryList.appendChild(orderItem);
            });
        }

        function searchOrders() {
            const searchTerm = document.getElementById('order-search').value.toLowerCase();
            const rows = document.querySelectorAll('#orders-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function searchInventory() {
            const searchTerm = document.getElementById('inventory-search').value.toLowerCase();
            const rows = document.querySelectorAll('#inventory-table-body tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        async function updateAllInventory() {
            if (confirm('Update all inventory from current menu data?')) {
                try {
                    if (db) {
                        const transaction = db.transaction(['inventory'], 'readwrite');
                        const objectStore = transaction.objectStore('inventory');
                        const clearRequest = objectStore.clear();
                        
                        clearRequest.onsuccess = () => {
                            stores.forEach(store => {
                                store.menu.forEach(item => {
                                    addToDatabase('inventory', {
                                        storeId: store.id,
                                        storeName: store.name,
                                        itemId: item.id,
                                        itemName: item.name,
                                        price: item.price,
                                        description: item.description,
                                        stock: item.stock,
                                        minStock: 10,
                                        maxStock: 100,
                                        lastUpdated: new Date().toISOString(),
                                        status: item.stock > 20 ? 'In Stock' : item.stock > 10 ? 'Low Stock' : 'Out of Stock'
                                    });
                                });
                            });
                            
                            showAlert('Success', 'All inventory updated!', 'success');
                            loadDashboardData();
                        };
                    }
                } catch (error) {
                    showAlert('Error', 'Failed to update inventory: ' + error.message, 'error');
                }
            }
        }

        function addNewInventoryItem() {
            showAlert('New Inventory Item', 'This feature would open a form to add new inventory items.', 'info');
        }

        // ==================== ACCOUNT MANAGEMENT ====================

        async function loadAccounts() {
            try {
                let accounts = [];
                
                if (db) {
                    accounts = await getAllFromDatabase('users');
                } else {
                    accounts = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                }
                
                renderAccountsTable(accounts);
                updateAccountStats(accounts);
                
            } catch (error) {
                console.error('Error loading accounts:', error);
                showAlert('Error', 'Failed to load accounts: ' + error.message, 'error');
            }
        }

        function renderAccountsTable(accounts) {
            const tbody = document.getElementById('accounts-table-body');
            tbody.innerHTML = '';
            
            if (accounts.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-users-slash fa-2x" style="color: var(--gray-400); margin-bottom: 1rem;"></i>
                            <p>No accounts found</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            accounts.forEach(account => {
                const row = document.createElement('tr');
                const statusClass = account.status === 'active' ? 'status-active' : 
                                  account.status === 'inactive' ? 'status-inactive' : 'status-pending';
                
                row.innerHTML = `
                    <td>${account.id || 'N/A'}</td>
                    <td>${account.firstName} ${account.lastName}</td>
                    <td>${account.email}</td>
                    <td>${account.phone || 'N/A'}</td>
                    <td>
                        <span class="badge ${account.role === 'admin' ? 'badge-warning' : 
                                          account.role === 'instructor' ? 'badge-info' : 'badge-success'}">
                            ${account.role}
                        </span>
                    </td>
                    <td>${account.course || account.department || 'N/A'}</td>
                    <td><span class="status-badge ${statusClass}">${account.status}</span></td>
                    <td>${new Date(account.registrationDate).toLocaleDateString()}</td>
                    <td>
                        <div class="action-buttons">
                            <button onclick="editAccount(${account.id || account.email})" class="btn-edit">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            ${account.status === 'active' ? 
                                `<button onclick="toggleAccountStatus('${account.id || account.email}', 'inactive')" class="btn-deactivate">
                                    <i class="fas fa-user-slash"></i> Deactivate
                                </button>` :
                                `<button onclick="toggleAccountStatus('${account.id || account.email}', 'active')" class="btn-activate">
                                    <i class="fas fa-user-check"></i> Activate
                                </button>`
                            }
                            ${account.role !== 'admin' ? 
                                `<button onclick="deleteAccount('${account.id || account.email}')" class="btn-delete">
                                    <i class="fas fa-trash"></i> Delete
                                </button>` : ''
                            }
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateAccountStats(accounts) {
            const totalUsers = accounts.length;
            const activeUsers = accounts.filter(a => a.status === 'active').length;
            const studentCount = accounts.filter(a => a.role === 'student').length;
            const instructorCount = accounts.filter(a => a.role === 'instructor').length;
            
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('active-users').textContent = activeUsers;
            document.getElementById('student-count').textContent = studentCount;
            document.getElementById('instructor-count').textContent = instructorCount;
        }

        // ==================== CHECKOUT AND RECEIPT FUNCTIONS ====================

        async function generateReceipt(phone, address, paymentNumber) {
            const orderId = 'NEMSU' + Date.now().toString().slice(-8);
            const now = new Date();
            
            // Calculate totals
            const subtotal = calculateSubtotal();
            const deliveryFee = 20;
            const serviceFee = 5;
            const total = subtotal + deliveryFee + serviceFee;
            
            // Create order object
            const order = {
                id: orderId,
                date: now.toISOString(),
                customerId: currentUser ? currentUser.id : null,
                customerName: currentUser ? 
                    `${currentUser.firstName} ${currentUser.lastName}` : 
                    'Guest User',
                customer: currentUser,
                phone: phone,
                address: address,
                paymentMethod: selectedPayment,
                paymentNumber: paymentNumber,
                subtotal: subtotal,
                deliveryFee: deliveryFee,
                serviceFee: serviceFee,
                total: total,
                status: 'Completed',
                items: cart.map(item => ({
                    storeId: item.storeId,
                    storeName: item.storeName,
                    itemId: item.itemId,
                    itemName: item.itemName,
                    price: item.price,
                    quantity: item.quantity
                }))
            };
            
            // Save order to database
            await saveOrderToDatabase(order);
            
            // Update receipt display
            document.getElementById('order-id').textContent = orderId;
            document.getElementById('receipt-date').textContent = now.toLocaleString();
            document.getElementById('receipt-customer').textContent = order.customerName;
            document.getElementById('receipt-phone').textContent = phone;
            document.getElementById('receipt-payment').textContent = selectedPayment.toUpperCase();
            document.getElementById('receipt-payment-number').textContent = paymentNumber || 'N/A';
            document.getElementById('receipt-subtotal').textContent = `${subtotal.toFixed(2)}`;
            document.getElementById('receipt-delivery').textContent = `${deliveryFee.toFixed(2)}`;
            document.getElementById('receipt-service').textContent = `${serviceFee.toFixed(2)}`;
            document.getElementById('receipt-total').textContent = `${total.toFixed(2)}`;
            
            // Display receipt items
            const receiptItems = document.getElementById('receipt-items');
            receiptItems.innerHTML = cart.map(item => `
                <div class="receipt-item">
                    <span>${item.quantity}x ${item.itemName} (${item.storeName})</span>
                    <span>${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');
            
            // Show receipt screen
            showScreen('receipt-screen');
            
            // Clear cart
            cart = [];
            updateCartCount();
            updateMenuCartCount();
            saveToLocalStorage();
            
            // Update dashboard if admin is logged in
            if (isAdminLoggedIn) {
                loadDashboardData();
            }
            
            showAlert('Order Successful', `Your order has been placed! Order ID: ${orderId}`, 'success');
        }

        function calculateSubtotal() {
            return cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }

        // ==================== UTILITY FUNCTIONS ====================

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            
            // Load data if admin dashboard
            if (screenId === 'admin-dashboard') {
                loadDashboardData();
                loadAccounts();
            }
            
            // Update user display if stores screen
            if (screenId === 'stores-screen') {
                updateUserDisplay();
            }
        }

        function showAlert(title, message, type = 'success') {
            const icon = type === 'success' ? 'fas fa-check-circle' :
                        type === 'error' ? 'fas fa-exclamation-circle' :
                        type === 'warning' ? 'fas fa-exclamation-triangle' :
                        'fas fa-info-circle';
            
            const color = type === 'success' ? 'var(--secondary)' :
                         type === 'error' ? 'var(--danger)' :
                         type === 'warning' ? 'var(--warning)' :
                         'var(--info)';
            
            document.getElementById('alert-icon').innerHTML = `<i class="${icon}"></i>`;
            document.getElementById('alert-icon').style.color = color;
            document.getElementById('alert-title').textContent = title;
            document.getElementById('alert-message').textContent = message;
            document.getElementById('alert-modal').classList.remove('hidden');
        }

        function closeAlert() {
            document.getElementById('alert-modal').classList.add('hidden');
        }

        function showTab(tabName, event) {
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // ==================== STORE AND MENU FUNCTIONS ====================

        function showStores() {
            showScreen('stores-screen');
            renderStores();
            updateUserDisplay();
            updateCartCount();
        }

        function renderStores() {
            const container = document.getElementById('stores-list');
            
            if (stores.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-store-slash fa-3x" style="color: var(--gray-400);"></i>
                        <h3>No stores available</h3>
                        <p>Please check back later</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = stores.map(store => `
                <div class="store-card" onclick="openStore(${store.id})">
                    <div class="store-header">
                        <div class="store-icon">
                            <i class="${store.icon}"></i>
                        </div>
                        <div class="store-info">
                            <h3>${store.name}</h3>
                            <div class="store-rating">
                                <i class="fas fa-star" style="color: var(--warning);"></i> ${store.rating}
                            </div>
                        </div>
                    </div>
                    <div class="store-body">
                        <p class="store-description">${store.description}</p>
                        <div class="store-tags">
                            <span class="store-tag">${store.category}</span>
                            <span class="store-tag">${store.priceRange}</span>
                            <span class="store-tag">${store.deliveryTime}</span>
                        </div>
                    </div>
                    <div class="store-footer">
                        <span class="store-status ${store.status}">
                            <i class="fas fa-circle"></i> ${store.status.toUpperCase()}
                        </span>
                        <button class="btn-primary btn-sm" onclick="event.stopPropagation(); openStore(${store.id})">
                            View Menu
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openStore(storeId) {
            currentStore = stores.find(store => store.id === storeId);
            if (!currentStore) return;
            
            showScreen('menu-screen');
            renderStoreMenu();
        }

        function renderStoreMenu() {
            document.getElementById('store-name').textContent = currentStore.name;
            document.getElementById('store-description').textContent = currentStore.description;
            document.getElementById('store-icon').innerHTML = `<i class="${currentStore.icon}"></i>`;
            document.getElementById('store-category').textContent = currentStore.category;
            document.getElementById('store-price-range').textContent = currentStore.priceRange;
            
            const container = document.getElementById('menu-list');
            
            if (!currentStore.menu || currentStore.menu.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-utensils-slash fa-3x" style="color: var(--gray-400);"></i>
                        <h3>Menu not available</h3>
                        <p>Please check back later</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = currentStore.menu.map(item => {
                const cartItem = cart.find(ci => 
                    ci.itemId === item.id && ci.storeId === currentStore.id
                );
                const quantity = cartItem ? cartItem.quantity : 0;
                
                return `
                    <div class="menu-item">
                        <div class="menu-item-content">
                            <div class="menu-item-header">
                                <div class="menu-item-title">${item.name}</div>
                                <div class="menu-item-price">${item.price}</div>
                            </div>
                            <p class="menu-item-description">${item.description}</p>
                            <div class="menu-item-actions">
                                <div class="quantity-control">
                                    <button class="btn-quantity" onclick="updateQuantity(${item.id}, ${quantity - 1})">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="quantity-display">${quantity}</span>
                                    <button class="btn-quantity" onclick="updateQuantity(${item.id}, ${quantity + 1})">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <button class="btn-add" onclick="updateQuantity(${item.id}, ${quantity + 1})">
                                    <i class="fas fa-cart-plus"></i> Add
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            updateMenuCartCount();
        }

        function updateQuantity(itemId, newQuantity) {
            if (isGuestMode || !currentUser) {
                if (newQuantity > 0) {
                    showGuestRestriction();
                }
                return;
            }
            
            if (newQuantity < 0) return;
            
            const existingIndex = cart.findIndex(ci => 
                ci.itemId === itemId && ci.storeId === currentStore.id
            );
            
            if (newQuantity === 0 && existingIndex !== -1) {
                cart.splice(existingIndex, 1);
            } else if (existingIndex !== -1) {
                cart[existingIndex].quantity = newQuantity;
            } else if (newQuantity > 0) {
                const item = currentStore.menu.find(m => m.id === itemId);
                cart.push({
                    itemId,
                    storeId: currentStore.id,
                    storeName: currentStore.name,
                    itemName: item.name,
                    price: item.price,
                    quantity: newQuantity
                });
            }
            
            updateCartCount();
            updateMenuCartCount();
            renderStoreMenu();
            saveToLocalStorage();
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
        }

        function updateMenuCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('menu-cart-count').textContent = totalItems;
        }

        // ==================== CART FUNCTIONS ====================

        function viewCart() {
            if (!checkUserAuthentication('view cart')) return;
            showScreen('cart-screen');
            renderCart();
        }

        function renderCart() {
            const container = document.getElementById('cart-items');
            const subtotal = calculateSubtotal();
            const deliveryFee = 20;
            const serviceFee = 5;
            const total = subtotal + deliveryFee + serviceFee;
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem;">
                        <i class="fas fa-shopping-cart fa-3x" style="color: var(--gray-400);"></i>
                        <h3>Your cart is empty</h3>
                        <p>Add items from stores to get started!</p>
                        <button class="btn-primary" onclick="backToStores()" style="margin-top: 1rem;">
                            <i class="fas fa-store"></i> Browse Stores
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = cart.map((item, index) => `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-header">
                                <div class="cart-item-title">${item.itemName}</div>
                                <div class="cart-item-price">${item.price}</div>
                            </div>
                            <div class="cart-item-store">${item.storeName}</div>
                            <div class="cart-item-actions">
                                <div class="quantity-control">
                                    <button class="btn-quantity" onclick="updateCartItemQuantity(${index}, ${item.quantity - 1})">
                                        <i class="fas fa-minus"></i>
                                    </button>
                                    <span class="quantity-display">${item.quantity}</span>
                                    <button class="btn-quantity" onclick="updateCartItemQuantity(${index}, ${item.quantity + 1})">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <button class="btn-sm" onclick="removeCartItem(${index})" style="background: var(--danger); color: white; border: none; padding: 0.5rem 1rem; border-radius: var(--radius); cursor: pointer;">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                        <div class="cart-item-total">
                            ${item.price * item.quantity}
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('cart-subtotal').textContent = `${subtotal.toFixed(2)}`;
            document.getElementById('cart-total').textContent = `${total.toFixed(2)}`;
        }

        function updateCartItemQuantity(index, newQuantity) {
            if (!checkUserAuthentication('update cart')) return;
            
            if (newQuantity < 0) return;
            
            if (newQuantity === 0) {
                cart.splice(index, 1);
            } else {
                cart[index].quantity = newQuantity;
            }
            
            updateCartCount();
            updateMenuCartCount();
            renderCart();
            saveToLocalStorage();
        }

        function removeCartItem(index) {
            if (!checkUserAuthentication('remove from cart')) return;
            
            cart.splice(index, 1);
            updateCartCount();
            updateMenuCartCount();
            renderCart();
            saveToLocalStorage();
        }

        function clearCart() {
            if (!checkUserAuthentication('clear cart')) return;
            
            if (cart.length === 0) return;
            
            if (confirm('Are you sure you want to clear your cart?')) {
                cart = [];
                updateCartCount();
                updateMenuCartCount();
                renderCart();
                saveToLocalStorage();
            }
        }

        // ==================== CHECKOUT FUNCTIONS ====================

        function checkout() {
            if (!checkUserAuthentication('checkout')) return;
            
            if (cart.length === 0) {
                showAlert('Empty Cart', 'Your cart is empty. Add items before checkout.', 'warning');
                return;
            }
            
            showScreen('checkout-screen');
            
            if (currentUser && currentUser.phone) {
                document.getElementById('checkout-phone').value = currentUser.phone;
            }
        }

        function selectPayment(method) {
            selectedPayment = method;
            
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.remove('active');
            });
            
            const selectedOption = event.currentTarget;
            selectedOption.classList.add('active');
        }

        async function placeOrder(event) {
            event.preventDefault();
            
            if (!checkUserAuthentication('place order')) return;
            
            const phone = document.getElementById('checkout-phone').value;
            const address = document.getElementById('delivery-address').value;
            
            if (!validatePhone(phone)) {
                showAlert('Invalid Phone', 'Please enter a valid 11-digit phone number starting with 09.', 'error');
                return;
            }
            
            let paymentNumber = '';
            if (selectedPayment === 'gcash') {
                paymentNumber = document.getElementById('gcash-number').value;
                if (!validatePhone(paymentNumber)) {
                    showAlert('Invalid GCash', 'Please enter a valid GCash number.', 'error');
                    return;
                }
            } else if (selectedPayment === 'paymaya') {
                paymentNumber = document.getElementById('paymaya-number').value;
                if (!validatePhone(paymentNumber)) {
                    showAlert('Invalid PayMaya', 'Please enter a valid PayMaya wallet number.', 'error');
                    return;
                }
            }
            
            if (!address.trim()) {
                showAlert('Missing Address', 'Please enter a delivery address.', 'error');
                return;
            }
            
            await generateReceipt(phone, address, paymentNumber);
        }

        // ==================== USER AUTHENTICATION ====================

        function showAuthOptions() {
            showScreen('auth-screen');
        }

        function showRegister() {
            closeGuestRestriction();
            selectRole('student');
            showScreen('register-screen');
        }

        function showLogin() {
            closeGuestRestriction();
            showScreen('login-screen');
        }

        function backToWelcome() {
            showScreen('welcome-screen');
        }

        function backToAuth() {
            showScreen('auth-screen');
        }

        function continueAsGuest() {
            currentUser = null;
            isGuestMode = true;
            isAdminLoggedIn = false;
            cart = [];
            showStores();
        }

        function selectRole(role) {
            userRole = role;
            
            document.querySelectorAll('.role-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (role === 'student') {
                document.getElementById('student-tab').classList.add('active');
                document.getElementById('academic-fields').innerHTML = `
                    <div class="form-group">
                        <label>Course <span class="required">*</span></label>
                        <select id="course" required>
                            <option value="">Select Course</option>
                            <option value="BSIT">BS Information Technology</option>
                            <option value="BSCS">BS Computer Science</option>
                            <option value="BSIS">BS Information Systems</option>
                            <option value="BSEd">BS Education</option>
                            <option value="BSBA">BS Business Administration</option>
                        </select>
                    </div>
                `;
            } else {
                document.getElementById('instructor-tab').classList.add('active');
                document.getElementById('academic-fields').innerHTML = `
                    <div class="form-group">
                        <label>Department <span class="required">*</span></label>
                        <select id="department" required>
                            <option value="">Select Department</option>
                            <option value="CCS">College of Computer Studies</option>
                            <option value="CIT">College of Industrial Technology</option>
                            <option value="CEA">College of Engineering & Architecture</option>
                            <option value="CBEAS">College of Business, Economics & Accountancy</option>
                            <option value="CTE">College of Teacher Education</option>
                            <option value="CON">College of Nursing</option>
                        </select>
                    </div>
                `;
            }
        }

        function validateEmail(email) {
            return email.endsWith('@gmail.com');
        }

        function validatePassword(password) {
            return password.length >= 4 && password.length <= 21;
        }

        function validatePhone(phone) {
            return /^09[0-9]{9}$/.test(phone);
        }

        async function registerUser(event) {
            event.preventDefault();
            
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const middleName = document.getElementById('middle-name').value;
            const age = parseInt(document.getElementById('age').value);
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!validateEmail(email)) {
                showAlert('Invalid Email', 'Email must end with @gmail.com', 'error');
                return;
            }
            
            if (!validatePassword(password)) {
                showAlert('Invalid Password', 'Password must be 4-21 characters long', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showAlert('Password Mismatch', 'Passwords do not match', 'error');
                return;
            }
            
            if (!validatePhone(phone)) {
                showAlert('Invalid Phone', 'Phone must be 11 digits starting with 09', 'error');
                return;
            }
            
            if (age < 15 || age > 80) {
                showAlert('Invalid Age', 'Age must be between 15 and 80', 'error');
                return;
            }
            
            const userData = {
                id: Date.now(),
                firstName,
                lastName,
                middleName,
                age,
                phone,
                email,
                password,
                role: userRole,
                status: 'active',
                notes: '',
                registrationDate: new Date().toISOString(),
                lastUpdated: new Date().toISOString()
            };
            
            if (userRole === 'student') {
                userData.course = document.getElementById('course').value;
                if (!userData.course) {
                    showAlert('Validation Error', 'Please select a course', 'error');
                    return;
                }
            } else {
                userData.department = document.getElementById('department').value;
                if (!userData.department) {
                    showAlert('Validation Error', 'Please select a department', 'error');
                    return;
                }
            }
            
            const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
            
            const existingUser = users.find(u => u.email === email);
            if (existingUser) {
                showAlert('Registration Failed', 'User with this email already exists!', 'error');
                return;
            }
            
            users.push(userData);
            localStorage.setItem('nemsuUsers', JSON.stringify(users));
            
            if (db) {
                try {
                    await addToDatabase('users', userData);
                } catch (error) {
                    console.error('Error saving to database:', error);
                }
            }
            
            event.target.reset();
            
            showRegistrationSuccess(userData);
        }

        function showRegistrationSuccess(userData) {
            document.getElementById('registration-title').textContent = 'Registration Successful!';
            document.getElementById('registration-message').textContent = `Account created for ${userData.firstName} ${userData.lastName}. What would you like to do next?`;
            
            document.getElementById('registration-success-modal').classList.remove('hidden');
        }

        function proceedToLogin() {
            document.getElementById('registration-success-modal').classList.add('hidden');
            showLogin();
        }

        function backToWelcomeFromRegistration() {
            document.getElementById('registration-success-modal').classList.add('hidden');
            showScreen('welcome-screen');
        }

        async function loginUser(event) {
            event.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                let user = null;
                
                if (db) {
                    const users = await getAllFromDatabase('users');
                    user = users.find(u => u.email === email && u.password === password);
                } else {
                    const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                    user = users.find(u => u.email === email && u.password === password);
                }
                
                if (user) {
                    if (user.status === 'inactive') {
                        showAlert('Account Inactive', 'Your account has been deactivated. Please contact admin.', 'error');
                        return;
                    }
                    
                    currentUser = user;
                    isGuestMode = false;
                    isAdminLoggedIn = user.role === 'admin';
                    
                    user.lastLogin = new Date().toISOString();
                    
                    // Update last login in database
                    if (db && user.id) {
                        await updateInDatabase('users', user.id, { lastLogin: user.lastLogin });
                    }
                    
                    // Update in localStorage
                    let users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                    const userIndex = users.findIndex(u => u.email === email);
                    if (userIndex !== -1) {
                        users[userIndex].lastLogin = user.lastLogin;
                        localStorage.setItem('nemsuUsers', JSON.stringify(users));
                    }
                    
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    showAlert('Login Successful', `Welcome back, ${user.firstName}!`, 'success');
                    
                    setTimeout(() => {
                        if (isAdminLoggedIn) {
                            showScreen('admin-dashboard');
                            loadDashboardData();
                            loadAccounts();
                        } else {
                            showStores();
                        }
                    }, 1500);
                } else {
                    showAlert('Login Failed', 'Invalid email or password', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showAlert('Login Error', 'An error occurred during login', 'error');
            }
        }

        function checkUserAuthentication(action) {
            if (isGuestMode || !currentUser) {
                showGuestRestriction();
                return false;
            }
            return true;
        }

        function showGuestRestriction() {
            document.getElementById('guest-restriction-modal').classList.remove('hidden');
        }

        function closeGuestRestriction() {
            document.getElementById('guest-restriction-modal').classList.add('hidden');
        }

        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('user-name').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
                document.getElementById('user-role').textContent = currentUser.role.charAt(0).toUpperCase() + currentUser.role.slice(1);
            } else if (isGuestMode) {
                document.getElementById('user-name').textContent = 'Guest User';
                document.getElementById('user-role').textContent = 'Guest';
            }
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                isGuestMode = false;
                isAdminLoggedIn = false;
                cart = [];
                localStorage.removeItem('currentUser');
                showScreen('welcome-screen');
            }
        }

        function adminLogout() {
            if (confirm('Are you sure you want to logout from admin panel?')) {
                isAdminLoggedIn = false;
                currentUser = null;
                showScreen('welcome-screen');
            }
        }

        // ==================== NAVIGATION FUNCTIONS ====================

        function backToStores() {
            showStores();
        }

        function backToMenu() {
            if (currentStore) {
                showScreen('menu-screen');
                renderStoreMenu();
            } else {
                backToStores();
            }
        }

        function backToCart() {
            viewCart();
        }

        // ==================== RECEIPT FUNCTIONS ====================

        function printReceipt() {
            window.print();
        }

        function newOrder() {
            showStores();
        }

        async function saveToDatabase() {
            try {
                await syncDatabase();
                showAlert('Success', 'Order saved to database successfully!', 'success');
            } catch (error) {
                showAlert('Error', 'Failed to save to database: ' + error.message, 'error');
            }
        }

        // ==================== DATA PERSISTENCE ====================

        function saveToLocalStorage() {
            localStorage.setItem('nemsu_cart', JSON.stringify(cart));
        }

        function loadFromLocalStorage() {
            const savedCart = localStorage.getItem('nemsu_cart');
            const savedUser = localStorage.getItem('currentUser');
            
            if (savedCart) cart = JSON.parse(savedCart);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isGuestMode = false;
                if (currentUser && currentUser.role === 'admin') {
                    isAdminLoggedIn = true;
                }
            }
        }

        // ==================== MINESWEEPER GAME ====================

        function showMinesweeper() {
            showScreen('minesweeper-screen');
            initMinesweeperGame();
        }

        function setDifficulty(level) {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`${level}-btn`).classList.add('active');

            switch(level) {
                case 'beginner':
                    minesweeperGame.rows = 10;
                    minesweeperGame.cols = 10;
                    minesweeperGame.mines = 10;
                    break;
                case 'intermediate':
                    minesweeperGame.rows = 12;
                    minesweeperGame.cols = 12;
                    minesweeperGame.mines = 20;
                    break;
                case 'expert':
                    minesweeperGame.rows = 15;
                    minesweeperGame.cols = 15;
                    minesweeperGame.mines = 40;
                    break;
            }
            minesweeperGame.difficulty = level;
            initMinesweeperGame();
        }

        function initMinesweeperGame() {
            minesweeperGame.board = [];
            minesweeperGame.revealed = [];
            minesweeperGame.flagged = [];
            minesweeperGame.gameOver = false;
            minesweeperGame.gameWon = false;
            minesweeperGame.firstMove = true;
            minesweeperGame.startTime = null;
            minesweeperGame.flagMode = false;
            minesweeperGame.hints = 3;

            if (minesweeperGame.timerInterval) {
                clearInterval(minesweeperGame.timerInterval);
            }

            for (let i = 0; i < minesweeperGame.rows; i++) {
                minesweeperGame.board[i] = new Array(minesweeperGame.cols).fill(0);
                minesweeperGame.revealed[i] = new Array(minesweeperGame.cols).fill(false);
                minesweeperGame.flagged[i] = new Array(minesweeperGame.cols).fill(false);
            }

            document.getElementById('game-status').textContent = 'Ready to play!';
            document.getElementById('game-status').className = 'game-status';
            document.getElementById('mines-left').textContent = minesweeperGame.mines;
            document.getElementById('game-time').textContent = '0s';
            document.getElementById('flags-used').textContent = '0';
            document.getElementById('hint-btn').innerHTML = '<i class="fas fa-lightbulb"></i> Hint (3 left)';
            document.getElementById('flag-mode-btn').innerHTML = '<i class="fas fa-flag"></i> Flag Mode: OFF';

            renderMinesweeperGrid();
        }

        function renderMinesweeperGrid() {
            const grid = document.getElementById('minesweeper-grid');
            grid.innerHTML = '';
            
            grid.style.gridTemplateColumns = `repeat(${minesweeperGame.cols}, 1fr)`;
            
            for (let i = 0; i < minesweeperGame.rows; i++) {
                for (let j = 0; j < minesweeperGame.cols; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    
                    cell.addEventListener('click', (e) => handleCellClick(i, j, e));
                    
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleCellRightClick(i, j);
                    });
                    
                    grid.appendChild(cell);
                }
            }
        }

        function handleCellClick(row, col, event) {
            if (minesweeperGame.gameOver || minesweeperGame.gameWon) return;
            
            if (minesweeperGame.flagMode) {
                handleCellRightClick(row, col);
                return;
            }

            if (minesweeperGame.firstMove) {
                minesweeperGame.firstMove = false;
                minesweeperGame.startTime = Date.now();
                generateMines(row, col);
                startTimer();
            }

            if (minesweeperGame.flagged[row][col]) return;

            revealCell(row, col);
            updateMinesweeperDisplay();
            checkWin();
        }

        function handleCellRightClick(row, col) {
            if (minesweeperGame.gameOver || minesweeperGame.gameWon) return;
            if (minesweeperGame.revealed[row][col]) return;

            minesweeperGame.flagged[row][col] = !minesweeperGame.flagged[row][col];
            updateMinesweeperDisplay();
            checkWin();
        }

        function generateMines(firstRow, firstCol) {
            let minesPlaced = 0;
            const safeCells = new Set();
            
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    const r = firstRow + dr;
                    const c = firstCol + dc;
                    if (r >= 0 && r < minesweeperGame.rows && c >= 0 && c < minesweeperGame.cols) {
                        safeCells.add(`${r},${c}`);
                    }
                }
            }

            while (minesPlaced < minesweeperGame.mines) {
                const row = Math.floor(Math.random() * minesweeperGame.rows);
                const col = Math.floor(Math.random() * minesweeperGame.cols);
                
                if (safeCells.has(`${row},${col}`)) continue;
                if (minesweeperGame.board[row][col] === -1) continue;

                minesweeperGame.board[row][col] = -1;
                minesPlaced++;

                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const r = row + dr;
                        const c = col + dc;
                        if (r >= 0 && r < minesweeperGame.rows && c >= 0 && c < minesweeperGame.cols) {
                            if (minesweeperGame.board[r][c] !== -1) {
                                minesweeperGame.board[r][c]++;
                            }
                        }
                    }
                }
            }
        }

        function revealCell(row, col) {
            if (row < 0 || row >= minesweeperGame.rows || col < 0 || col >= minesweeperGame.cols) return;
            if (minesweeperGame.revealed[row][col] || minesweeperGame.flagged[row][col]) return;

            minesweeperGame.revealed[row][col] = true;

            if (minesweeperGame.board[row][col] === -1) {
                minesweeperGame.gameOver = true;
                revealAllMines();
                document.getElementById('game-status').textContent = 'Game Over! You hit a mine!';
                document.getElementById('game-status').className = 'game-status lose';
                showAlert('Minesweeper', 'Game Over! You hit a mine!', 'error');
                return;
            }

            if (minesweeperGame.board[row][col] === 0) {
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        revealCell(row + dr, col + dc);
                    }
                }
            }
        }

        function revealAllMines() {
            for (let i = 0; i < minesweeperGame.rows; i++) {
                for (let j = 0; j < minesweeperGame.cols; j++) {
                    if (minesweeperGame.board[i][j] === -1) {
                        minesweeperGame.revealed[i][j] = true;
                    }
                }
            }
        }

        function updateMinesweeperDisplay() {
            const cells = document.querySelectorAll('#minesweeper-grid .cell');
            let flagCount = 0;
            
            cells.forEach(cell => {
                const row = parseInt(cell.dataset.row);
                const col = parseInt(cell.dataset.col);
                
                cell.className = 'cell';
                
                if (minesweeperGame.flagged[row][col]) {
                    cell.classList.add('flagged');
                    cell.innerHTML = '<i class="fas fa-flag"></i>';
                    flagCount++;
                } else if (minesweeperGame.revealed[row][col]) {
                    cell.classList.add('revealed');
                    if (minesweeperGame.board[row][col] === -1) {
                        cell.classList.add('mine');
                        cell.innerHTML = '<i class="fas fa-bomb"></i>';
                    } else if (minesweeperGame.board[row][col] > 0) {
                        cell.classList.add(`number-${minesweeperGame.board[row][col]}`);
                        cell.textContent = minesweeperGame.board[row][col];
                    }
                } else {
                    cell.textContent = '';
                }
            });

            const minesLeft = minesweeperGame.mines - flagCount;
            document.getElementById('mines-left').textContent = minesLeft;
            document.getElementById('flags-used').textContent = flagCount;
        }

        function checkWin() {
            let allNonMinesRevealed = true;
            let allMinesFlagged = true;
            let correctFlags = 0;

            for (let i = 0; i < minesweeperGame.rows; i++) {
                for (let j = 0; j < minesweeperGame.cols; j++) {
                    if (minesweeperGame.board[i][j] !== -1 && !minesweeperGame.revealed[i][j]) {
                        allNonMinesRevealed = false;
                    }
                    if (minesweeperGame.board[i][j] === -1 && !minesweeperGame.flagged[i][j]) {
                        allMinesFlagged = false;
                    }
                    if (minesweeperGame.board[i][j] === -1 && minesweeperGame.flagged[i][j]) {
                        correctFlags++;
                    }
                }
            }

            if (allNonMinesRevealed && allMinesFlagged) {
                minesweeperGame.gameWon = true;
                document.getElementById('game-status').textContent = 'Congratulations! You won!';
                document.getElementById('game-status').className = 'game-status win';
                showAlert('Minesweeper', `Congratulations! You cleared the board in ${getElapsedTime()} seconds!`, 'success');
                
                for (let i = 0; i < minesweeperGame.rows; i++) {
                    for (let j = 0; j < minesweeperGame.cols; j++) {
                        if (minesweeperGame.board[i][j] === -1 && !minesweeperGame.flagged[i][j]) {
                            minesweeperGame.flagged[i][j] = true;
                        }
                    }
                }
                updateMinesweeperDisplay();
            }
        }

        function startTimer() {
            minesweeperGame.startTime = Date.now();
            clearInterval(minesweeperGame.timerInterval);
            minesweeperGame.timerInterval = setInterval(() => {
                document.getElementById('game-time').textContent = getElapsedTime() + 's';
            }, 1000);
        }

        function getElapsedTime() {
            if (!minesweeperGame.startTime) return 0;
            return Math.floor((Date.now() - minesweeperGame.startTime) / 1000);
        }

        function resetMinesweeperGame() {
            initMinesweeperGame();
        }

        function toggleFlagMode() {
            minesweeperGame.flagMode = !minesweeperGame.flagMode;
            const btn = document.getElementById('flag-mode-btn');
            if (minesweeperGame.flagMode) {
                btn.innerHTML = '<i class="fas fa-flag"></i> Flag Mode: ON';
                btn.classList.add('active');
            } else {
                btn.innerHTML = '<i class="fas fa-flag"></i> Flag Mode: OFF';
                btn.classList.remove('active');
            }
        }

        function showHint() {
            if (minesweeperGame.hints <= 0) {
                showAlert('No Hints Left', 'You have used all your hints!', 'warning');
                return;
            }

            const safeCells = [];
            for (let i = 0; i < minesweeperGame.rows; i++) {
                for (let j = 0; j < minesweeperGame.cols; j++) {
                    if (!minesweeperGame.revealed[i][j] && !minesweeperGame.flagged[i][j] && 
                        minesweeperGame.board[i][j] !== -1) {
                        safeCells.push({row: i, col: j});
                    }
                }
            }

            if (safeCells.length > 0) {
                const hint = safeCells[Math.floor(Math.random() * safeCells.length)];
                
                const cell = document.querySelector(`[data-row="${hint.row}"][data-col="${hint.col}"]`);
                cell.style.backgroundColor = 'var(--warning)';
                setTimeout(() => {
                    if (!minesweeperGame.revealed[hint.row][hint.col]) {
                        cell.style.backgroundColor = '';
                    }
                }, 1000);

                minesweeperGame.hints--;
                document.getElementById('hint-btn').innerHTML = `<i class="fas fa-lightbulb"></i> Hint (${minesweeperGame.hints} left)`;
                
                showAlert('Hint', `Safe cell at row ${hint.row + 1}, column ${hint.col + 1}`, 'info');
            } else {
                showAlert('No Hints Available', 'No safe cells to reveal!', 'warning');
            }
        }

        function cheatMode() {
            if (minesweeperGame.gameOver || minesweeperGame.gameWon) return;
            
            const originalRevealed = JSON.parse(JSON.stringify(minesweeperGame.revealed));
            
            for (let i = 0; i < minesweeperGame.rows; i++) {
                for (let j = 0; j < minesweeperGame.cols; j++) {
                    if (minesweeperGame.board[i][j] === -1) {
                        minesweeperGame.revealed[i][j] = true;
                    }
                }
            }
            
            updateMinesweeperDisplay();
            
            setTimeout(() => {
                for (let i = 0; i < minesweeperGame.rows; i++) {
                    for (let j = 0; j < minesweeperGame.cols; j++) {
                        minesweeperGame.revealed[i][j] = originalRevealed[i][j];
                    }
                }
                updateMinesweeperDisplay();
            }, 2000);
            
            showAlert('Cheat Mode', 'Mines revealed for 2 seconds!', 'warning');
        }

        // ==================== ANALYTICS FUNCTIONS ====================

        function updateAnalytics() {
            const ctx = document.getElementById('analyticsChart')?.getContext('2d');
            if (!ctx) return;
            
            if (analyticsChart) {
                analyticsChart.destroy();
            }
            
            const range = document.getElementById('analytics-range')?.value || 'month';
            const type = document.getElementById('analytics-type')?.value || 'sales';
            
            let data, labels, chartType;
            
            switch(type) {
                case 'sales':
                    chartType = 'bar';
                    labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    data = [1200, 1900, 1500, 2000, 1800, 2200, 2500];
                    break;
                case 'users':
                    chartType = 'line';
                    labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    data = [50, 75, 100, 150];
                    break;
                case 'popular':
                    chartType = 'doughnut';
                    labels = ['Shawarma', 'Burger', 'Siomai', 'Fruit Shake', 'Takoyaki'];
                    data = [45, 35, 60, 40, 25];
                    break;
            }
            
            analyticsChart = new Chart(ctx, {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: type === 'sales' ? 'Sales ()' : 
                               type === 'users' ? 'New Users' : 'Popularity',
                        data: data,
                        backgroundColor: type === 'popular' ? [
                            'rgb(79, 70, 229)',
                            'rgb(16, 185, 129)',
                            'rgb(245, 158, 11)',
                            'rgb(59, 130, 246)',
                            'rgb(239, 68, 68)'
                        ] : 'rgb(79, 70, 229)',
                        borderColor: 'rgb(255, 255, 255)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // ==================== ADMIN HELPER FUNCTIONS ====================

        function showAllUsers() {
            document.querySelector('.admin-tab.active').classList.remove('active');
            document.querySelector('[onclick*="accounts"]').classList.add('active');
            
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById('accounts-tab').classList.add('active');
            
            loadAccounts();
        }

        function filterAccounts() {
            const roleFilter = document.getElementById('account-filter-role').value;
            const statusFilter = document.getElementById('account-filter-status').value;
            const searchTerm = document.getElementById('account-search').value.toLowerCase();
            
            const rows = document.querySelectorAll('#accounts-table-body tr');
            
            rows.forEach(row => {
                if (row.querySelector('td')) {
                    const role = row.querySelector('td:nth-child(5) span').textContent.toLowerCase();
                    const status = row.querySelector('td:nth-child(7) span').textContent.toLowerCase();
                    const text = row.textContent.toLowerCase();
                    
                    const roleMatch = roleFilter === 'all' || role.includes(roleFilter);
                    const statusMatch = statusFilter === 'all' || status.includes(statusFilter);
                    const searchMatch = text.includes(searchTerm);
                    
                    row.style.display = (roleMatch && statusMatch && searchMatch) ? '' : 'none';
                }
            });
        }

        function searchAccounts() {
            filterAccounts();
        }

        function refreshAccounts() {
            loadAccounts();
        }

        function exportAccounts() {
            try {
                const accounts = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const exportData = {
                    timestamp: new Date().toISOString(),
                    totalAccounts: accounts.length,
                    accounts: accounts,
                    system: 'NEMSU Chow Zone Account Export'
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportFileName = `nemsu_accounts_${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileName);
                linkElement.click();
                
                showAlert('Export Successful', 'Accounts exported successfully!', 'success');
                
            } catch (error) {
                showAlert('Export Failed', 'Error exporting accounts: ' + error.message, 'error');
            }
        }

        async function syncDatabase() {
            try {
                showAlert('Syncing...', 'Syncing data with database...', 'info');
                
                const localUsers = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                for (const user of localUsers) {
                    await addToDatabase('users', user);
                }
                
                const localOrders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                for (const order of localOrders) {
                    await addToDatabase('orders', order);
                }
                
                await loadDashboardData();
                
                showAlert('Sync Complete', 'Data synchronized successfully!', 'success');
            } catch (error) {
                showAlert('Sync Failed', 'Error syncing data: ' + error.message, 'error');
            }
        }

        function exportData() {
            const exportData = {
                timestamp: new Date().toISOString(),
                users: JSON.parse(localStorage.getItem('nemsuUsers') || '[]'),
                orders: JSON.parse(localStorage.getItem('nemsuOrders') || '[]'),
                system: 'NEMSU Food Ordering System'
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `nemsu_data_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showAlert('Export Successful', 'Data exported successfully!', 'success');
        }

        function exportToSQLite() {
            try {
                const users = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const orders = JSON.parse(localStorage.getItem('nemsuOrders') || '[]');
                
                let sql = `-- NEMSU Chow Zone Database Export
-- Generated: ${new Date().toISOString()}

CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY,
    first_name TEXT NOT NULL,
    last_name TEXT NOT NULL,
    middle_name TEXT NOT NULL,
    age INTEGER NOT NULL,
    phone TEXT NOT NULL,
    email TEXT NOT NULL,
    password TEXT NOT NULL,
    role TEXT NOT NULL,
    course TEXT,
    department TEXT,
    status TEXT NOT NULL,
    notes TEXT,
    registration_date TEXT NOT NULL,
    last_login TEXT,
    last_updated TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS orders (
    id TEXT PRIMARY KEY,
    date TEXT NOT NULL,
    customer_id INTEGER,
    customer_name TEXT NOT NULL,
    phone TEXT NOT NULL,
    address TEXT NOT NULL,
    payment_method TEXT NOT NULL,
    payment_number TEXT,
    subtotal REAL NOT NULL,
    delivery_fee REAL NOT NULL,
    service_fee REAL NOT NULL,
    total REAL NOT NULL,
    status TEXT NOT NULL,
    FOREIGN KEY (customer_id) REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS order_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    order_id TEXT NOT NULL,
    store_id INTEGER NOT NULL,
    store_name TEXT NOT NULL,
    item_id INTEGER NOT NULL,
    item_name TEXT NOT NULL,
    price REAL NOT NULL,
    quantity INTEGER NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(id)
);

`;
                
                users.forEach(user => {
                    sql += `INSERT INTO users (id, first_name, last_name, middle_name, age, phone, email, password, role, ${user.course ? 'course' : 'department'}, status, notes, registration_date, last_login, last_updated) VALUES (
    ${user.id},
    '${escapeSingleQuotes(user.firstName)}',
    '${escapeSingleQuotes(user.lastName)}',
    '${escapeSingleQuotes(user.middleName)}',
    ${user.age},
    '${user.phone}',
    '${user.email}',
    '${user.password}',
    '${user.role}',
    '${escapeSingleQuotes(user.course || user.department || '')}',
    '${user.status || 'active'}',
    '${escapeSingleQuotes(user.notes || '')}',
    '${user.registrationDate}',
    '${user.lastLogin || ''}',
    '${user.lastUpdated || user.registrationDate}'
);\n`;
                });
                
                sql += "\n";
                orders.forEach(order => {
                    sql += `INSERT INTO orders (id, date, customer_id, customer_name, phone, address, payment_method, payment_number, subtotal, delivery_fee, service_fee, total, status) VALUES (
    '${order.id}',
    '${order.date}',
    ${order.customer?.id || 'NULL'},
    '${escapeSingleQuotes((order.customer?.firstName || 'Guest') + ' ' + (order.customer?.lastName || ''))}',
    '${order.phone}',
    '${escapeSingleQuotes(order.address)}',
    '${order.paymentMethod}',
    '${order.paymentNumber || ''}',
    ${order.subtotal},
    ${order.deliveryFee},
    ${order.serviceFee},
    ${order.total},
    '${order.status}'
);\n`;
                    
                    order.items?.forEach(item => {
                        sql += `INSERT INTO order_items (order_id, store_id, store_name, item_id, item_name, price, quantity) VALUES (
    '${order.id}',
    ${item.storeId},
    '${escapeSingleQuotes(item.storeName)}',
    ${item.itemId},
    '${escapeSingleQuotes(item.itemName)}',
    ${item.price},
    ${item.quantity}
);\n`;
                    });
                });
                
                const blob = new Blob([sql], { type: 'application/sql' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `nemsu_chowzone_${new Date().toISOString().split('T')[0]}.sql`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showAlert('Export Successful', 'SQL file downloaded successfully! You can import this into SQLite or MySQL database.', 'success');
            } catch (error) {
                showAlert('Export Failed', 'Error exporting data: ' + error.message, 'error');
            }
        }

        function escapeSingleQuotes(str) {
            if (typeof str !== 'string') return str;
            return str.replace(/'/g, "''");
        }

        // ==================== EDIT ACCOUNT FUNCTIONS ====================

        async function editAccount(accountId) {
            try {
                let account = null;
                
                if (db) {
                    const users = await getAllFromDatabase('users');
                    account = users.find(u => u.id === accountId || u.email === accountId);
                } else {
                    const accounts = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                    account = accounts.find(a => a.id === accountId || a.email === accountId);
                }
                
                if (!account) {
                    showAlert('Error', 'Account not found!', 'error');
                    return;
                }
                
                document.getElementById('edit-account-id').value = account.id || account.email;
                document.getElementById('edit-first-name').value = account.firstName || '';
                document.getElementById('edit-last-name').value = account.lastName || '';
                document.getElementById('edit-middle-name').value = account.middleName || '';
                document.getElementById('edit-age').value = account.age || '';
                document.getElementById('edit-phone').value = account.phone || '';
                document.getElementById('edit-email').value = account.email || '';
                document.getElementById('edit-role').value = account.role || 'student';
                document.getElementById('edit-status').value = account.status || 'active';
                document.getElementById('edit-notes').value = account.notes || '';
                
                toggleEditRoleFields();
                
                if (account.role === 'student' && account.course) {
                    document.getElementById('edit-course').value = account.course;
                } else if (account.role === 'instructor' && account.department) {
                    document.getElementById('edit-department').value = account.department;
                }
                
                document.getElementById('edit-account-modal').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading account:', error);
                showAlert('Error', 'Failed to load account: ' + error.message, 'error');
            }
        }

        function toggleEditRoleFields() {
            const role = document.getElementById('edit-role').value;
            
            if (role === 'student') {
                document.getElementById('edit-course-field').style.display = 'block';
                document.getElementById('edit-department-field').style.display = 'none';
                document.getElementById('edit-course').required = true;
                document.getElementById('edit-department').required = false;
            } else if (role === 'instructor') {
                document.getElementById('edit-course-field').style.display = 'none';
                document.getElementById('edit-department-field').style.display = 'block';
                document.getElementById('edit-course').required = false;
                document.getElementById('edit-department').required = true;
            } else {
                document.getElementById('edit-course-field').style.display = 'none';
                document.getElementById('edit-department-field').style.display = 'none';
                document.getElementById('edit-course').required = false;
                document.getElementById('edit-department').required = false;
            }
        }

        async function saveAccountChanges(event) {
            event.preventDefault();
            
            const accountId = document.getElementById('edit-account-id').value;
            const firstName = document.getElementById('edit-first-name').value;
            const lastName = document.getElementById('edit-last-name').value;
            const middleName = document.getElementById('edit-middle-name').value;
            const age = parseInt(document.getElementById('edit-age').value);
            const phone = document.getElementById('edit-phone').value;
            const email = document.getElementById('edit-email').value;
            const role = document.getElementById('edit-role').value;
            const status = document.getElementById('edit-status').value;
            const notes = document.getElementById('edit-notes').value;
            
            if (!firstName || !lastName || !email || !phone || !age) {
                showAlert('Validation Error', 'Please fill in all required fields', 'error');
                return;
            }
            
            if (!validatePhone(phone)) {
                showAlert('Invalid Phone', 'Phone must be 11 digits starting with 09', 'error');
                return;
            }
            
            if (!validateEmail(email)) {
                showAlert('Invalid Email', 'Email must end with @gmail.com', 'error');
                return;
            }
            
            try {
                const accountData = {
                    firstName,
                    lastName,
                    middleName,
                    age,
                    phone,
                    email,
                    role,
                    status,
                    notes,
                    lastUpdated: new Date().toISOString()
                };
                
                if (role === 'student') {
                    const course = document.getElementById('edit-course').value;
                    if (!course) {
                        showAlert('Validation Error', 'Please select a course for student', 'error');
                        return;
                    }
                    accountData.course = course;
                    accountData.department = null;
                } else if (role === 'instructor') {
                    const department = document.getElementById('edit-department').value;
                    if (!department) {
                        showAlert('Validation Error', 'Please select a department for instructor', 'error');
                        return;
                    }
                    accountData.department = department;
                    accountData.course = null;
                } else {
                    accountData.course = null;
                    accountData.department = null;
                }
                
                let updated = false;
                
                if (db) {
                    const users = await getAllFromDatabase('users');
                    const user = users.find(u => u.id === parseInt(accountId) || u.email === accountId);
                    if (user) {
                        accountData.id = user.id;
                        accountData.password = user.password;
                        accountData.registrationDate = user.registrationDate;
                        await updateInDatabase('users', user.id, accountData);
                        updated = true;
                    }
                }
                
                let accounts = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const index = accounts.findIndex(a => a.id === parseInt(accountId) || a.email === accountId);
                if (index !== -1) {
                    accountData.id = accounts[index].id;
                    accountData.password = accounts[index].password;
                    accountData.registrationDate = accounts[index].registrationDate;
                    accounts[index] = { ...accounts[index], ...accountData };
                    localStorage.setItem('nemsuUsers', JSON.stringify(accounts));
                    updated = true;
                }
                
                if (!updated) {
                    accountData.id = Date.now();
                    accountData.password = 'default123';
                    accountData.registrationDate = new Date().toISOString();
                    accounts.push(accountData);
                    localStorage.setItem('nemsuUsers', JSON.stringify(accounts));
                    
                    if (db) {
                        await addToDatabase('users', accountData);
                    }
                }
                
                if (currentUser && (currentUser.id === parseInt(accountId) || currentUser.email === accountId)) {
                    currentUser = accountData;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                showAlert('Success', 'Account updated successfully!', 'success');
                closeEditModal();
                loadAccounts();
                
            } catch (error) {
                console.error('Error saving account:', error);
                showAlert('Error', 'Failed to save account: ' + error.message, 'error');
            }
        }

        async function toggleAccountStatus(accountId, newStatus) {
            const action = newStatus === 'active' ? 'activate' : 'deactivate';
            
            if (!confirm(`Are you sure you want to ${action} this account?`)) {
                return;
            }
            
            try {
                let updated = false;
                
                if (db) {
                    const users = await getAllFromDatabase('users');
                    const user = users.find(u => u.id === parseInt(accountId) || u.email === accountId);
                    if (user) {
                        await updateInDatabase('users', user.id, { 
                            status: newStatus,
                            lastUpdated: new Date().toISOString()
                        });
                        updated = true;
                    }
                }
                
                let accounts = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const index = accounts.findIndex(a => a.id === parseInt(accountId) || a.email === accountId);
                if (index !== -1) {
                    accounts[index].status = newStatus;
                    accounts[index].lastUpdated = new Date().toISOString();
                    localStorage.setItem('nemsuUsers', JSON.stringify(accounts));
                    updated = true;
                }
                
                if (updated) {
                    if (currentUser && (currentUser.id === parseInt(accountId) || currentUser.email === accountId)) {
                        currentUser.status = newStatus;
                        localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    }
                    
                    showAlert('Success', `Account ${action}d successfully!`, 'success');
                    loadAccounts();
                } else {
                    showAlert('Error', 'Account not found!', 'error');
                }
                
            } catch (error) {
                console.error('Error toggling account status:', error);
                showAlert('Error', 'Failed to update account status: ' + error.message, 'error');
            }
        }

        async function deleteAccount(accountId) {
            if (!confirm('Are you sure you want to delete this account? This action cannot be undone.')) {
                return;
            }
            
            try {
                let deleted = false;
                
                if (db) {
                    const users = await getAllFromDatabase('users');
                    const user = users.find(u => u.id === parseInt(accountId) || u.email === accountId);
                    if (user && user.role !== 'admin') {
                        await deleteFromDatabase('users', user.id);
                        deleted = true;
                    }
                }
                
                let accounts = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const index = accounts.findIndex(a => a.id === parseInt(accountId) || a.email === accountId);
                if (index !== -1 && accounts[index].role !== 'admin') {
                    accounts.splice(index, 1);
                    localStorage.setItem('nemsuUsers', JSON.stringify(accounts));
                    deleted = true;
                }
                
                if (deleted) {
                    if (currentUser && (currentUser.id === parseInt(accountId) || currentUser.email === accountId)) {
                        currentUser = null;
                        localStorage.removeItem('currentUser');
                    }
                    
                    showAlert('Success', 'Account deleted successfully!', 'success');
                    loadAccounts();
                } else {
                    showAlert('Error', 'Cannot delete admin accounts!', 'error');
                }
                
            } catch (error) {
                console.error('Error deleting account:', error);
                showAlert('Error', 'Failed to delete account: ' + error.message, 'error');
            }
        }

        function resetPassword() {
            const accountId = document.getElementById('edit-account-id').value;
            const newPassword = prompt('Enter new password for this account (min 4 characters):');
            
            if (!newPassword || newPassword.length < 4) {
                showAlert('Error', 'Password must be at least 4 characters long', 'error');
                return;
            }
            
            if (!confirm('Are you sure you want to reset the password for this account?')) {
                return;
            }
            
            try {
                if (db) {
                    const users = getAllFromDatabase('users').then(users => {
                        const user = users.find(u => u.id === parseInt(accountId) || u.email === accountId);
                        if (user) {
                            updateInDatabase('users', user.id, { 
                                password: newPassword,
                                lastUpdated: new Date().toISOString()
                            });
                        }
                    });
                }
                
                let accounts = JSON.parse(localStorage.getItem('nemsuUsers') || '[]');
                const index = accounts.findIndex(a => a.id === parseInt(accountId) || a.email === accountId);
                if (index !== -1) {
                    accounts[index].password = newPassword;
                    accounts[index].lastUpdated = new Date().toISOString();
                    localStorage.setItem('nemsuUsers', JSON.stringify(accounts));
                }
                
                showAlert('Success', 'Password reset successfully! New password: ' + newPassword, 'success');
                
            } catch (error) {
                console.error('Error resetting password:', error);
                showAlert('Error', 'Failed to reset password: ' + error.message, 'error');
            }
        }

        function closeEditModal() {
            document.getElementById('edit-account-modal').classList.add('hidden');
            document.getElementById('edit-account-form').reset();
        }


        function exitApp() {
            if (confirm('Are you sure you want to exit NEMSU Chow Zone?')) {
                showAlert('Thank you!', 'Thank you for visiting NEMSU Chow Zone. See you again!', 'info');
                setTimeout(() => {
                    document.body.innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center;">
                            <div>
                                <h1 style="font-size: 3rem;"></h1>
                                <h2>Thank you for visiting NEMSU CHOW ZONE!</h2>
                                <p>System closed</p>
                            </div>
                        </div>
                    `;
                }, 2000);
            }
        }


        document.addEventListener('DOMContentLoaded', function() {
            loadFromLocalStorage();
            updateCartCount();
            
            initDatabase().catch(() => {
                console.log('Using localStorage as fallback');
            });
            
            selectPayment('gcash');
            
            setDifficulty('beginner');
            
            document.getElementById('edit-account-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditModal();
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeEditModal();
                    closeAlert();
                    closeGuestRestriction();
                    document.getElementById('registration-success-modal').classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>